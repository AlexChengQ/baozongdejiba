var codeMirror,evt,xmlns="http://www.w3.org/2000/svg",lineHigh=50,columnHigh=50,lineNum=0,stepNum=0,classicName="$",classicNum=0,flag=0,QinitStr="",isDrag=!1;$(document).ready(function(){command(),codeCollection(),$("#svgBoard").find('rect[index="1"]').each(function(){-1<$(this).attr("id").indexOf("n2")||dragObj($(this).attr("id"))}),$("#saveProperty").click(function(t){if(null!=fromAdmin&&"1"==fromAdmin)return prompt(messages.unauthorized_operation),!1;if(t.stopPropagation(),isCase()&&isSemi()){if("iSWAP"==$("rect[focus=true][index='1']").attr("type")){if(e=(e=$("#property").val().trim()).replace(/\s*/g,"").replace(/\n/g,"").replace(/\r/g,""),$("#property").val(e),32<e.length)return prompt(messages.expression_32),!1;if(""==e||!expressionRegexp(e))return prompt(messages.expression_is_not_legal),!1;$("rect[focus=true][index='1']").attr("operation",e)}else if("Measure"==$("rect[focus=true][index='1']").attr("type"))$("rect[focus=true][index='1']").attr("register",$("#classicName").val());else{var e;if(e=(e=$("#property").val().trim()).replace(/\s*/g,"").replace(/\n/g,"").replace(/\r/g,""),$("#property").val(e),32<e.length)return prompt(messages.expression_32),!1;if(""==e||!expressionRegexp(e))return prompt(messages.expression_is_not_legal),!1;$("rect[focus=true][index='1']").attr("expression",e)}$(".LayerSetting").hide(),$(".LaySetLine1").hide(),$(".LaySetLine3").hide(),$("#commandTip").hide(),$(".LaySetLine2").hide(),$(".LayConfirm").hide(),1==$("#svgBoard rect[type='Measure']").length?1!=getCookie("isNext")&&1!=getCookie("isCookie")||($(".guideId19").attr("style",""),$(".LayerSetting").attr("style",""),CloudCLD.guideLocation(30,60,0,0,0,0,13,-48,20,".pointTag8")):2==$("#svgBoard rect[type='Measure']").length&&(1!=getCookie("isNext")&&1!=getCookie("isCookie")||($(".guideId22").attr("style",""),$(".LayerSetting").attr("style",""),CloudCLD.guideLocation(70,50,"auto","auto",-60,-88,13,-48,23,".New_edit"))),prompt(messages.settings_successful,"success")}}),$("#savePropertyClear").on("click",function(){$(".LayerSetting").hide(),$(".LaySetLine1").hide(),$(".LaySetLine3").hide(),$("#commandTip").hide(),$(".LaySetLine2").hide(),$(".LayConfirm").hide(),1!=getCookie("isNext")&&1!=getCookie("isCookie")||(1==$("#svgBoard rect[type='Measure']").length?($(".guideId19").attr("style",""),$(".LayerSetting").attr("style",""),CloudCLD.guideLocation(30,60,0,0,0,0,13,-48,20,".pointTag8")):2==$("#svgBoard rect[type='Measure']").length&&($(".guideId22").attr("style",""),$(".LayerSetting").attr("style",""),CloudCLD.guideLocation(70,50,"auto","auto",-60,-88,13,-48,23,".New_edit")))})});var appendRectSvg="";function appendRect(t,e,r,n,a,i,s){var c=document.createElementNS(xmlns,"rect");return c.setAttribute("id",t),""==i&&""==s||(c.setAttribute("cx",i),c.setAttribute("cy",s)),c.setAttribute("x",e),c.setAttribute("y",r),c.setAttribute("width",18),c.setAttribute("height",18),c.setAttribute("rx",9),c.setAttribute("ry",9),c.setAttribute("index","1"),c.setAttribute("r","9"),c.setAttribute("qi",n),c.setAttribute("qs",a),c.setAttribute("fill","#B3DE7B"),c}function resetRect(){$("#svgBoard rect[index='1']").attr("stroke","none"),$("#svgBoard rect[index='0']").attr("stroke","none"),$("rect[focus=true][index='0']").attr("fill","#fff"),$("rect[focus=true][index='0']").attr("fill-opacity","0"),$("rect[focus=true][index='0']").attr("r","3"),$("rect[focus=true][index='0']").attr("stroke","none"),$("rect[focus=true][index='0']").removeAttr("focus")}function resetHL(){$("rect[width='14'][index='0']").each(function(t){$(this).attr({fill:"#fff",x:parseInt($(this).attr("x"))-22,y:parseInt($(this).attr("y"))-12,width:"60",height:"40",rx:"0",ry:"0",stroke:"none","stroke-width":"none","fill-opacity":"0"})})}function resetView(){$(".LayerSetting").hide(),$(".LaySetLine1").hide(),$(".LaySetLine3").hide(),$("#commandTip").hide(),$(".LaySetLine2").hide(),$(".LayConfirm").hide()}function command(){if(null!=fromAdmin&&"1"==fromAdmin)return!1;$(".Layer_Con .Layer_sort_con li").click(function(t){if(!checkGrammar())return!1;if(0!=$("rect[focus=true][index='1']").length||0==$("rect[focus=true][index='0']").length)return $(this).addClass("current"),resetRect(),$("rect[focus=true][index='1']").removeAttr("focus"),isDrag=!1;var i=$("rect[focus=true][index='0']").attr("qi"),s=$("rect[focus=true][index='0']").attr("qs"),e=$(this).attr("type");if(1!=getCookie("isNext")&&1!=getCookie("isCookie")||("H"==$(this).attr("type")?($(".guideId11").attr("style",""),CloudCLD.guideLocation(30,60,0,0,0,0,13,-48,12,".pointTag3")):"CNOT"==$(this).attr("type")?($(".guideId14").attr("style",""),CloudCLD.guideLocation(30,60,0,0,0,0,13,-48,15,".pointTag5")):"Measure"==$(this).attr("type")&&(0==$("#svgBoard rect[type='Measure']").length?($(".guideId18").attr("style",""),setTimeout(function(){CloudCLD.guideLocation(45,50,-60,-30,"auto","auto",13,-48,19,".LayerSetting")},100)):1==$("#svgBoard rect[type='Measure']").length&&($(".guideId21").attr("style",""),setTimeout(function(){CloudCLD.guideLocation(45,50,-60,-30,"auto","auto",13,-48,22,".LayerSetting")},100)))),isDrag||$(".LayerContent").hide(),"Measure"==e){var r=-1,n="",a=!1,c=1;if($("rect[qi="+i+"][index='0']").each(function(){var t=$(this).attr("qs");if(n=i+"-"+t,0<$("#"+n).length&&(parseInt($("#"+n).attr("qi"))==parseInt(oQi)&&parseInt($("#"+n).attr("qs"))==parseInt(oQs)||(r=t),"Measure"==$("#"+n).attr("type"))){if(isDrag){if(parseInt($("#"+n).attr("qi"))==parseInt(oQi)&&parseInt($("#"+n).attr("qs"))==parseInt(oQs))return;c+=1}else c+=1;return a?void 0:void(a=!0)}}),parseInt(s)<=parseInt(r))return prompt(messages.measure_is_end),checkCircle(),!1;if(a&&!isDrag)return prompt(messages.measure_is_only),checkCircle(),!1;if(isDrag&&(a=!1),1<parseInt(c))return prompt(messages.measure_is_only),checkCircle(),!1;var o="";if($("rect[qi="+i+"][index='0']").each(function(){var t=$(this).attr("qs");if(parseInt(t)>parseInt(s)&&(0<$("rect[qi="+i+"][qs="+t+"][index='0']").length||0<$("rect[qi="+i+"][qs="+t+"][index='1']").length))if(0<$("rect[qi="+i+"][qs="+t+"][index='1']").length){var e=$("rect[qi="+i+"][qs="+t+"][index='1']");if(0<=e.attr("id").indexOf("n2")||0<=e.attr("id").indexOf("n3"))return!(a=!0);if(getIdentification(o=buildIdentification(o,i+"-"+t),i+"-"+t))return!(a=!0)}else if(getIdentification(o=buildIdentification(o,i+"-"+t),i+"-"+t))return!(a=!0)}),a)return prompt(messages.measure_not_more_qubit),checkCircle(),!1}else{r=-1,n="",a=!1;if($("rect[qi="+i+"][index='0']").each(function(){var t=$(this).attr("qs");n=i+"-"+t,0<$("#"+n).length&&"Measure"==$("#"+n).attr("type")&&(r=t)}),-1!=parseInt(r)&&parseInt(r)<=parseInt(s))return prompt(messages.measure_is_end),checkCircle(),!1;"CNOT"!=e&&"iSWAP"!=e&&"CR"!=e&&"Toffoli"!=e||(AttBuit(),$(".LayerContent").hide())}parseFloat(s),parseFloat(columnHigh),parseFloat(i),parseFloat(lineHigh);$("rect[qs="+s+"][index='1']").each(function(){var t=!0;if($(this).attr("qi")==i?t=!1:$(this).attr("n2")&&$("#"+$(this).attr("n2")).attr("qi")==i?t=!1:$(this).attr("n3")&&$("#"+$(this).attr("n3")).attr("qi")==i&&(t=!1),!t)return prompt(messages.point_already_exists),checkCircle(),t});var u=!0;if($("line[name='verticalLine']").each(function(t,e){var r=$(e).attr("x1"),n=$(e).attr("y1"),a=($(e).attr("x2"),$(e).attr("y2"));if(s*columnHigh==r&&(n/lineHigh<i&&i<a/lineHigh))return u=!1}),!u)return prompt(messages.icons_not_allowed),checkCircle(),!1;var d=$("#svg_"+e+" g").clone();if(0!=$("rect[focus=true][index='0']").length)return d.attr("transform","translate("+(+$("rect[focus=true][index='0']").attr("x")+5)+","+(+$("rect[focus=true][index='0']").attr("y")-5)+")"),$(d).find("rect").attr("stroke","black"),$(d).find("rect").attr("stroke-width","1"),$(d).find("rect").attr("qi",i),$(d).find("rect").attr("qs",s),$(d).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")),$(d).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")),$(d).find("rect").attr("id",i+"-"+s),$(d).find("rect").attr("type",e),$(d).find("rect").attr("focus","true"),$(d).attr("onclick","clickImage(evt)"),"RZ"==e||"RX"==e||"RY"==e||"CR"==e?$(d).find("rect").attr("expression","pi/4"):"Measure"==e?0==parseInt(analogType)?$(d).find("rect").attr("register",classicName+""+i):$(d).find("rect").attr("register",i):"iSWAP"==e&&$(d).find("rect").attr("operation","pi"),$("rect[focus=true][index='0']").parent().append(d),isDrag=!1,propertyBoard(i+"-"+s),dragObj(i+"-"+s),!1;isDrag=!1})}var timer,goFor,LineFor,flagClick,setIntTime=null,setClickTime=null;function resetFlag(){clearTimeout(setIntTime),clearTimeout(setClickTime),flag=0}function clickImage(t){setIntTime=setTimeout("resetFlag()",850),evt=t,0!=++flag&&(setClickTime=setTimeout("clickImage2();",200)),t.stopPropagation()}function clickImage2(){if(null==fromAdmin||fromAdmin,isCase()&&isSemi()){if($(".commandList dd.current").removeClass("current"),$(".dmhj dd.current").removeClass("current"),isDrag=!1,2==flag){if(null!=fromAdmin&&"1"==fromAdmin)return!1;if($(evt.target).attr("refid")){var t=$(evt.target).attr("refid");if("iSWAP"==$(evt.target).attr("type")&&$("#"+$("#"+t).attr("n2")).parent().remove(),$("line[n2='"+$("#"+t).attr("n2")+"']").remove(),$("#"+$("#"+t).attr("n2")).remove(),$("line[n3='"+$("#"+t).attr("n3")+"']").remove(),$("#"+$("#"+t).attr("n3")).remove(),$("rect[refid='"+t+"'][index='1']").remove(),$("#"+t).parent().remove(),resetView(),"CNOT"==(e=$(evt.target).attr("type"))||"iSWAP"==e||"CR"==e||"Toffoli"==e){if(null==(s=$(evt.target).attr("n2")))return AttBuit(1),!1;if("Toffoli"==e&&s&&null==$(evt.target).attr("n3"))return AttBuit(1),!1}}else{0<$("line[n2='"+$(evt.target).attr("n2")+"']").length?($("line[n2='"+$(evt.target).attr("n2")+"']").remove(),"iSWAP"==$(evt.target).attr("type")&&$("#"+$(evt.target).attr("n2")).parent().remove(),$("#"+$(evt.target).attr("n2")).remove(),$("line[n3='"+$(evt.target).attr("n3")+"']").remove(),$("#"+$(evt.target).attr("n3")).remove()):($("line[n2='"+$(evt.target).parent().find("rect[index='1']").attr("n2")+"']").remove(),"iSWAP"==$(evt.target).parent().find("rect[index='1']").attr("type")&&$("#"+$(evt.target).parent().find("rect[index='1']").attr("n2")).parent().remove(),$("#"+$(evt.target).parent().find("rect[index='1']").attr("n2")).remove(),$("line[n3='"+$(evt.target).parent().find("rect[index='1']").attr("n3")+"']").remove(),$("#"+$(evt.target).parent().find("rect[index='1']").attr("n3")).remove()),$(evt.target).parent().remove(),resetView();var e,r=$("rect[focus=true][index='1']");if(rectCommand=r[0],"CNOT"==(e=$(rectCommand).attr("type"))||"iSWAP"==e||"CR"==e||"Toffoli"==e){if(null==(s=$(rectCommand).attr("n2")))return AttBuit(1),!1;if("Toffoli"==e&&s&&null==$(rectCommand).attr("n3"))return AttBuit(1),!1}}resetHL()}else if(1==flag){var n=$("rect[focus=true][index='1']");if(1==n.length&&($(n).attr("qi")!=$(evt.target).attr("qi")||$(n).attr("qs")!=$(evt.target).attr("qs"))){currentCommand=n[0];var a=$(currentCommand).attr("type");if("RZ"==a||"RX"==a||"RY"==a){if(32<(i=$(currentCommand).attr("expression")).length)return prompt(messages.expression_32),!1;if(""==i||!expressionRegexp(i))return prompt(messages.expression_is_not_legal),!1}if("CR"==a&&null!=$(currentCommand).attr("n2")){var i;if(32<(i=$(currentCommand).attr("expression")).length)return prompt(messages.expression_32),!1;if(""==i||!expressionRegexp(i))return prompt(messages.expression_is_not_legal),!1}if("CNOT"==a||"iSWAP"==a||"CR"==a||"Toffoli"==a){var s;if(null==(s=$(currentCommand).attr("n2")))return prompt(messages.second_points_must_be_set),!1;if("Toffoli"==a&&s&&null==$(currentCommand).attr("n3"))return prompt(messages.Second_points_must_be_set),!1}}if($("#svgBoard rect[index='1'][width='40']").attr("stroke","none"),$("#svgBoard rect[index='0'][width='60']").attr("stroke","none"),$("rect[focus=true][index='0'][width='60']").attr("fill","#fff"),$("rect[focus=true][index='0'][width='60']").attr("fill-opacity","0"),$("rect[focus=true][index='0'][width='60']").attr("r","3"),$("rect[focus=true][index='0'][width='60']").attr("stroke","none"),$("rect[focus=true][index='1'][width='40']").removeAttr("focus"),$(evt.target).attr("refid")){t=$(evt.target).attr("refid");$("#"+t).attr("stroke","black"),$("#"+t).attr("focus","true"),propertyBoard(t)}else null==$(evt.target).attr("qi")?($(evt.target).siblings("rect").attr("stroke","black"),$(evt.target).siblings("rect").attr("focus","true"),0==flagM?(flagM=1,propertyBoard($(evt.target).siblings("rect").attr("id"),1)):propertyBoard($(evt.target).siblings("rect").attr("id"))):($(evt.target).attr("stroke","black"),$(evt.target).attr("focus","true"),0==flagM?(flagM=1,propertyBoard($(evt.target).attr("id"),1)):propertyBoard($(evt.target).attr("id")))}return!1}}function clickDotCircle(t){var r=[],e=parseInt($(t.currentTarget).attr("x"))+30,n=parseInt($(t.currentTarget).attr("x")),a=parseInt($(t.currentTarget).attr("y"));if($('line[x1="'+e+'"]').each(function(t,e){r.push({y1:$(this).attr("y1"),y2:$(this).attr("y2")})}),commandTypeClick=$("rect[index='1'][refcx='"+n+"'][refcy='"+a+"']").attr("type"),null!=commandTypeClick){var i=$($("rect[focus=true][index='1']")).attr("n2");if(null==i)return prompt(messages.second_points_must_be_set),!1;if("Toffoli"==$($("rect[focus=true][index='1']")).attr("type")&&i&&null==$($("rect[focus=true][index='1']")).attr("n3"))return prompt(messages.second_points_must_be_set),!1}if(""==r)clickDotCircleNext(t);else{for(var s=flagClick=0,c=0;c<r.length;c++)if(parseInt($(t.currentTarget).attr("y"))>parseInt(r[c].y1)&&parseInt($(t.currentTarget).attr("y"))<parseInt(r[c].y2)){s=1,t.stopPropagation();break}0==s&&(0==flagClick&&(flagClick++,clickDotCircleNext(t)),t.stopPropagation())}t.stopPropagation()}function clickDotCircleNext(t){if(timer&&clearTimeout(timer),null!=fromAdmin&&"1"==fromAdmin)return!1;isCase()&&isSemi()&&(timer=setTimeout(function(){resetFlag()},250),evt=t,goFor=$(evt.currentTarget).attr("qs")||$(evt.target).attr("qs"),LineFor=$(evt.currentTarget).attr("qi")||$(evt.target).attr("qi"),_clickCircle(),2==++flag&&(flag=0,clearTimeout(timer)),t.stopPropagation())}function mouseoverDotDotCircle(t){}function mouseoutDotCircle(t){}function clickCircle(t){if(timer&&clearTimeout(timer),null!=fromAdmin&&"1"==fromAdmin)return!1;isCase()&&isSemi()&&(isDrag=!1,timer=setTimeout(function(){resetFlag()},250),evt=t,goFor=$(evt.currentTarget).attr("qs"),LineFor=$(evt.currentTarget).attr("qi"),_clickCircle(),2==++flag&&(flag=0,clearTimeout(timer)),t.stopPropagation())}function layerContent(){var t=event||window.event,e=document.documentElement.scrollLeft||document.body.scrollLeft,r=document.documentElement.scrollTop||document.body.scrollTop,n=t.pageX||t.clientX+e,a=t.pageY||t.clientY+r;isDrag||goFor!=$('rect[index="1"][qi="'+LineFor+'"][qs="'+goFor+'"]').attr("qs")&&($(".LayerContent").css({top:a+30,left:n-$(".LayerContent").width()/2}),$(".LayerContent").show())}function _clickCircle(){var t=$("rect[focus=true][index='1']");if(("CNOT"==$(t[0]).attr("type")||"iSWAP"==$(t[0]).attr("type")||"Toffoli"==$(t[0]).attr("type")||"CR"==$(t[0]).attr("type"))&&goFor!=$("rect[focus=true][index='1']").attr("qs")&&null==$("rect[focus=true][index='1']").attr("n2")&&isSelfDrag)return!1;if(1==t.length){currentCommand=t[0];var r=parseInt($(evt.target).attr("qi")),n=parseInt($(evt.target).attr("qs")),e=parseInt($(currentCommand).attr("qi")),a=parseInt($(currentCommand).attr("qs")),i=$(currentCommand).attr("type");if(("CNOT"==i||"iSWAP"==i||"Toffoli"==i||"CR"==i)&&("Toffoli"!=i&&null==$(currentCommand).attr("n2")||"Toffoli"==i&&null==$(currentCommand).attr("n3"))){var s=!1;if($("rect[qi="+r+"][index='0']").each(function(){var t=$(this).attr("qs");if(parseInt(t)<parseInt(n)){var e=r+"-"+t;if(0<$("#"+e).length&&"Measure"==$("#"+e).attr("type"))return!(s=!0)}}),s)return prompt(messages.measure_is_end),!1}if("RZ"==i||"RX"==i||"RY"==i||"CR"==i&&null!=$(currentCommand).attr("n2")){var c=$(currentCommand).attr("expression");if(32<c.length)return prompt(messages.expression_32),!1;if(""==c||!expressionRegexp(c))return prompt(messages.expression_is_not_legal),!1}if("CNOT"==i||"iSWAP"==i||"CR"==i||"Toffoli"==i){if($(currentCommand).attr("qs")==$(evt.target).attr("qs")&&$(currentCommand).attr("qi")==$(evt.target).attr("qi"))return!1;var o=$(currentCommand).attr("n2");if(o)"Toffoli"!=i&&(resetRect(),$(currentCommand).removeAttr("focus"),resetView(),evt.target.setAttribute("fill","#fff"),evt.target.setAttribute("fill-opacity","0"),evt.target.setAttribute("r","7"),evt.target.setAttribute("stroke","none"),evt.target.setAttribute("focus","true"));else if($(currentCommand).attr("qs")!=$(evt.target).attr("qs")){if(!isSelfDrag)return prompt(messages.second_points_must_be_on_vertical_line),!1;resetRect(),$(currentCommand).removeAttr("focus"),resetView(),evt.target.setAttribute("fill","#333"),evt.target.setAttribute("r","7"),evt.target.setAttribute("stroke","#333"),evt.target.setAttribute("focus","true")}else{(l=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+r+"-"+a),l.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),l.setAttribute("fill","#a6ce38");var u=0,d=0;if("60"==$(evt.target).attr("width")?(u=22,d=12):isGlobalNumber=0,r<e){for(var p=r+1;p<e;p++)if(0!=$("#"+p+"-"+a).length)return prompt(messages.already_exists_on_vertical_line),!1;l.setAttribute("x1",parseInt($(evt.target).attr("x"))+8+u),l.setAttribute("x2",parseInt($(currentCommand).attr("refcx"))+30),l.setAttribute("y1",parseInt($(evt.target).attr("y"))+28+d),l.setAttribute("y2",parseInt($(currentCommand).attr("refcy"))-10),"Toffoli"==i?(l.setAttribute("y1",parseInt($(evt.target).attr("y"))+8+d),l.setAttribute("y2",parseInt($(currentCommand).attr("refcy"))+10)):("iSWAP"==i?l.setAttribute("y1",parseInt($(evt.target).attr("y"))+28+d):l.setAttribute("y1",parseInt($(evt.target).attr("y"))+6+d),l.setAttribute("y2",parseInt($(currentCommand).attr("refcy")))),$(currentCommand).parent().parent().append(l)}else if(e<r){for(p=e+1;p<r;p++)if(0!=$("#"+p+"-"+a).length)return prompt(messages.already_exists_on_vertical_line),!1;l.setAttribute("x1",parseInt($(currentCommand).attr("refcx"))+30),l.setAttribute("y1",parseInt($(currentCommand).attr("refcy"))+37),l.setAttribute("x2",parseInt($(evt.target).attr("x"))+8+u),l.setAttribute("y2",parseInt($(evt.target).attr("y"))+8+d),$(evt.target).parent().append(l)}if("iSWAP"==i){var f=$("#svg_iSWAP g").clone();f.attr("transform","translate("+(parseInt($(evt.target).attr("x"))-17+u)+","+(parseInt($(evt.target).attr("y"))-17+d)+")"),$(f).find("rect").attr("qi",r),$(f).find("rect").attr("qs",n),$(f).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")-22),$(f).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")-12),$(f).find("rect").attr("id","n2-"+r+"-"+n),$(f).find("rect").attr("type",i),$(f).find("rect").attr("refid",e+"-"+a),$(f).find("rect").attr("onclick","clickImage(evt)"),$(evt.target).parent().append(f)}else appendRectSvg=appendRect("n2-"+r+"-"+a,parseInt($(evt.target).attr("x"))-1+u,parseInt($(evt.target).attr("y"))-2+d,r,n,$(evt.target).attr("x")-22+u,$(evt.target).attr("y")-12+d),$(evt.target).parent().append(appendRectSvg);"Toffoli"!=i&&($(currentCommand).attr("stroke","none"),isSelfDrag=!1,resetHL()),$(".LayerContent").hide(),$(currentCommand).attr("n2","n2-"+r+"-"+a)}if("Toffoli"==i&&o){var l;if($(currentCommand).attr("n3"))return resetRect(),$(currentCommand).removeAttr("focus"),evt.target.setAttribute("fill","#fff"),evt.target.setAttribute("fill-opacity","0"),evt.target.setAttribute("r","7"),evt.target.setAttribute("stroke","none"),evt.target.setAttribute("focus","true"),void layerContent();if($(currentCommand).attr("qs")!=$(evt.target).attr("qs"))return isSelfDrag?(resetRect(),$(currentCommand).removeAttr("focus"),evt.target.setAttribute("fill","#ff"),evt.target.setAttribute("fill-opacity","0"),evt.target.setAttribute("r","7"),evt.target.setAttribute("stroke","none"),void evt.target.setAttribute("focus","true")):(prompt(messages.third_points_must_be_on_vertical_line),!1);(l=document.createElementNS(xmlns,"line")).setAttribute("n3","n3-"+e+"-"+a),l.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),l.setAttribute("fill","#B3DE7B");u=0,d=0;if("60"==$(evt.target).attr("width")?(u=22,d=12):isGlobalNumber=0,r<e){for(p=r+1;p<e;p++)if(0!=$("#"+p+"-"+a).length)return prompt(messages.already_exists_on_vertical_line),!1;l.setAttribute("x2",parseInt($(evt.target).attr("x"))+8+u),l.setAttribute("y2",parseInt($(evt.target).attr("y"))-2+d),l.setAttribute("x1",parseInt($(currentCommand).attr("refcx"))+30),l.setAttribute("y1",parseInt($(currentCommand).attr("refcy"))),$(currentCommand).parent().parent().append(l)}else if(e<r){for(p=e+1;p<r;p++)if(0!=$("#"+p+"-"+a).length)return prompt(messages.already_exists_on_vertical_line),!1;l.setAttribute("x1",parseInt($(currentCommand).attr("refcx"))+30),l.setAttribute("y1",parseInt($(currentCommand).attr("refcy"))+40),l.setAttribute("x2",parseInt($(evt.target).attr("x"))+8+u),l.setAttribute("y2",parseInt($(evt.target).attr("y"))-2+d),$(evt.target).parent().append(l)}appendRectSvg=appendRect("n3-"+e+"-"+a,parseInt($(evt.target).attr("x"))-1+u,parseInt($(evt.target).attr("y"))-2+d,r,n,"",""),$(evt.target).parent().append(appendRectSvg),$(currentCommand).removeAttr("focus"),$(currentCommand).attr("stroke","none"),resetHL(),$(".LayerContent").hide(),isSelfDrag=!1,$(currentCommand).attr("n3","n3-"+e+"-"+a)}}else resetRect(),$(currentCommand).removeAttr("focus"),evt.target.setAttribute("fill","#fff"),evt.target.setAttribute("fill-opacity","0"),evt.target.setAttribute("r","7"),evt.target.setAttribute("stroke","none"),evt.target.setAttribute("focus","true"),resetView()}else resetRect(),$("image[focus=true]").removeAttr("focus"),evt.target.setAttribute("fill","#fff"),evt.target.setAttribute("fill-opacity","0"),evt.target.setAttribute("r","7"),evt.target.setAttribute("stroke","none"),evt.target.setAttribute("focus","true"),resetView();layerContent(),$("rect[width=14][index='0']").each(function(t){parseInt($(this).attr("x")-22)!=parseInt($("rect[focus=true][index='1']").attr("refcx"))&&$(this).attr({fill:"#fff",x:parseInt($(this).attr("x"))-22,y:parseInt($(this).attr("y"))-12,width:"60",height:"40",rx:"0",ry:"0",stroke:"none","stroke-width":"none","fill-opacity":"0"})})}function dblclickCircle(){return checkGrammar()&&(evt.target.setAttribute("fill","#fff"),evt.target.setAttribute("fill-opacity","0"),evt.target.removeAttribute("focus"),evt.target.setAttribute("r","3"),evt.target.setAttribute("stroke","none"),resetView()),!1}function canRun(){return 0==$("#svgBoard rect[type='Measure']").length?(prompt(messages.must_be_included_measurement),!1):checkGrammar("","")}function checkGrammar(t,e){var r=$("rect[focus=true][index='1']");0==r.length&&(r=$(e));var n=e||r,a=$(n).attr("type");if("CNOT"!=a&&"iSWAP"!=a&&"CR"!=a&&"Toffoli"!=a&&("CNOT"==$(r).attr("type")||"iSWAP"==$(r).attr("type")||"CR"==$(r).attr("type")||"Toffoli"==$(r).attr("type"))){if(null==$(r).attr("n2")&&null!=a)return prompt(messages.select_another_operation_point),!1;if(null==$(r).attr("n3")&&null!=a&&"Toffoli"==$(r).attr("type"))return prompt(messages.select_second_operation_point),!1}if("CNOT"==a||"iSWAP"==a||"CR"==a||"Toffoli"==a)if(t)if(null==$(r).attr("n2")&&null!=$(n).attr("n2")&&null!=r.attr("type")){if("CNOT"==r.attr("type")||"iSWAP"==r.attr("type")||"CR"==r.attr("type")||"Toffoli"==r.attr("type"))return prompt(messages.select_another_operation_point),!1}else{if(null==$(r).attr("n2")&&null!=$(n).attr("n2")&&"Toffoli"!=a)return prompt(messages.select_another_operation_point),!1;if($(n).attr("qs")!=r.attr("qs")&&null==$(n).attr("n2")&&"Toffoli"!=a)return prompt(messages.select_another_operation_point),!1;if($(n).attr("qs")!=r.attr("qs")&&null==r.attr("qs")&&null==$(r).attr("n2")&&"Toffoli"==a)return!0;if($(n).attr("qs")!=r.attr("qs")&&null==$(r).attr("n2")&&"Toffoli"==a)return prompt(messages.select_another_operation_point),!1;if($(n).attr("qs")!=r.attr("qs")&&null==$(r).attr("n3")&&"Toffoli"==$(r).attr("type"))return prompt(messages.select_second_operation_point),!1;if($(n).attr("qs")!=r.attr("qs")||null!=$(r).attr("n2"))return!0;deleteIcon($(n)),resetView(),checkCircle()}else{if("#333"!=$(r).attr("stroke")&&null==$(r).attr("n2"))return prompt(messages.select_another_operation_point),!1;if("Toffoli"==a&&null==$(r).attr("n3"))return prompt(messages.select_second_operation_point),!1}else if("RZ"==a||"RX"==a||"RY"==a||"CR"==a){if(""==t&&""==e)return!0;$(r).attr("expression",$("#property").val());var i=null==$(r).attr("expression")?"":$(r).attr("expression").trim();if(""==i||!expressionRegexp(i))return prompt(messages.expression_is_not_legal),!1}else"Measure"==a&&0==parseInt(analogType)&&""!=t&&""!=e&&$(r).attr("register",$("#classicName").val());return!0}function expressionRegexp(t){return/^\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*$/.exec(t)}function trans2Code(){if(!checkGrammar("",""))return!1;trans2CodeStatus=0;for(var t="",e="",r="PMEASURE ",n=1;n<=stepNum;n++)for(var a=0;a<lineNum;a++)if(0!=$("#"+a+"-"+n).length){var i=$("#"+a+"-"+n),s=$(i).attr("type");if("H"==s)t+="H "+a+"\n";else if("NOT"==s)t+="RX "+a+',"pi"\n';else if("ZPi"==s)t+="RZ "+a+',"pi"\n';else if("XPi2"==s)t+="RX "+a+',"pi/2"\n';else if("YPi2"==s)t+="RY "+a+',"pi/2"\n';else if("ZPi2"==s)t+="RZ "+a+',"pi/2"\n';else if("CNOT"==s){t+="CNOT "+$("#"+$(i).attr("n2")).attr("qi")+","+a+"\n"}else if("iSWAP"==s){t+="ISWAP "+$("#"+$(i).attr("n2")).attr("qi")+","+a+',"'+$(i).attr("operation")+'"\n'}else if("Toffoli"==s){t+="TOFFOLI "+$("#"+$(i).attr("n2")).attr("qi")+","+$("#"+$(i).attr("n3")).attr("qi")+","+a+"\n"}else if("Measure"==s){if(0==parseInt(analogType))t+="MEASURE "+a+","+$(i).attr("register")+"\n";else if(1==parseInt(analogType))e=""==e?a+"":e+","+a;else if(2==parseInt(analogType)){t+="MEASURE "+a+",$"+$(i).attr("register")+"\n"}}else if("RZ"==s){t+="RZ "+a+',"'+$(i).attr("expression")+'"\n'}else if("RX"==s){t+="RX "+a+',"'+$(i).attr("expression")+'"\n'}else if("RY"==s){t+="RY "+a+',"'+$(i).attr("expression")+'"\n'}else if("CR"==s){t+="CR "+$("#"+$(i).attr("n2")).attr("qi")+","+a+',"'+$(i).attr("expression")+'"\n'}}return""!=e&&(t+=r=r+e+"\n"),$("#qcodeTextarea").text(""),codeMirror=null!=fromAdmin&&"1"==fromAdmin?CodeMirror(document.getElementById("qcodeTextarea"),{value:t,lineNumbers:!0,mode:"javascript",keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai",readOnly:!0,tabSize:2}):CodeMirror(document.getElementById("qcodeTextarea"),{value:t,lineNumbers:!0,mode:"javascript",keyMap:"sublime",autoCloseBrackets:!0,matchBrackets:!0,showCursorWhenSelecting:!0,theme:"monokai",readOnly:!1,tabSize:2}),trans2CodeStatus=1,codeMirror.getValue()}function getSvgXml(){return document.getElementById("svgBoard").parentNode.innerHTML}function svgBoard(t,e,r,n){if(lineNum=t,stepNum=e,classicNum=r,classicName=n,0!=$("#svgBoard").length){if($("#svgBoard text").remove(),$("#svgBoard rect[index='0']").each(function(){parseInt(""+$(this).attr("r"))<10&&$(this).attr("r","5")}),$("#svgBoard").attr("version","1.1"),lineNum=0,$("#svgBoard line").each(function(){$(this).attr("y1")==$(this).attr("y2")&&(stepNum=$(this).parent().find("rect").length,$(this).attr("x1","50"),lineNum++)}),0!=$("rect[focus=true][index='1']").length){var a=$("rect[focus=true][index='1']").attr("type");"RZ"!=a&&"RX"!=a&&"RY"!=a&&"CR"!=a||($("#property").val($("rect[focus=true][index='1']").attr("expression")),propertyBoard($("rect[focus=true][index='1']").attr("id")))}return $("#svgBoard").attr("width",50*stepNum+150),void(50*lineNum<300?$("#svgBoard").attr("height",300):$("#svgBoard").attr("height",50*lineNum+50))}var i=60*stepNum+100,s=62*lineNum;s<300&&(s=300);var c=document.createElementNS(xmlns,"svg");c.setAttributeNS(null,"width",i),c.setAttributeNS(null,"height",s),c.setAttributeNS(null,"version","1.1"),c.setAttributeNS(null,"id","svgBoard");for(var o=33,u=0;u<lineNum;u++){var d=document.createElementNS(xmlns,"g");c.appendChild(d);var p=document.createElementNS(xmlns,"line");p.setAttribute("x1",0),p.setAttribute("y1",o),p.setAttribute("x2",i),p.setAttribute("y2",o),p.setAttribute("data-dis","2"),p.setAttribute("stroke","#333"),p.setAttribute("style","stroke-width:2"),d.appendChild(p);for(var f=25,l=1;l<=stepNum;l++){var m=document.createElementNS(xmlns,"rect");m.setAttribute("qi",u),m.setAttribute("qs",l),m.setAttribute("x",f),m.setAttribute("y",o-20),m.setAttribute("width","60"),m.setAttribute("height","40"),m.setAttribute("index","0"),m.setAttribute("stroke","none"),m.setAttribute("fill","#fff"),m.setAttribute("fill-opacity","0"),d.appendChild(m),f+=60,m.setAttribute("onclick","clickDotCircle(evt)")}o+=62}document.getElementById("modRight_center").appendChild(c)}function prompt(t,e){var r="error";e&&(r=e),noty({text:t,type:r,dismissQueue:!0,layout:"topCenter",theme:"relax",timeout:1500})}function judgeSign(t){if(new RegExp("^-?[0-9]*.?[0-9]*$").test(t))return t==Math.abs(t)?1:0}function AttBuit(t){var r=[],e=[],n=0,a=0;if(1==t)try{cxs=$("rect[focus=true][index='1']").attr("refcx").toString(),n=$("rect[focus=true][index='1']").attr("qi").toString(),a=$("rect[focus=true][index='1']").attr("qs").toString()}catch(t){return!1}else cxs=$("rect[focus=true][index='0']").attr("x").toString(),n=$("rect[focus=true][index='0']").attr("qi").toString(),a=$("rect[focus=true][index='0']").attr("qs").toString();$("#svgBoard rect[type='Measure'][index='1']").each(function(){parseInt($(this).attr("qs"))<=parseInt(a)&&e.push($(this).attr("qi"))}),$("rect[id][qs='"+a+"']").each(function(t){var e=$(this).attr("id").split("-");null!=$(this).attr("focus")&&"false"!=$(this).attr("focus")||(2==e.length?"none"!=$(this).parent().css("display")&&"none"!=$(this).css("display")&&r.push(e[0]):3==$(this).attr("id").split("-").length&&"none"!=$(this).parent().css("display")&&"none"!=$(this).css("display")&&r.push(e[1]))});for(var i=[],s=[],c=0;c<lineTS;c++)c!=n&&(s.push(c),i.push(c));for(var o=0;o<e.length;o++)i.remove(parseInt(e[o]));for(var u=0,d=minNum=0;d<r.length;d++)parseInt(r[d])>parseInt(n)?(0==minNum&&(minNum=Number(r[d])),r[d]<minNum&&(minNum=Number(r[d]))):r[d]>=u&&(u=Number(r[d]));for(var p=0;p<s.length;p++)""==u&&""!=minNum?s[p]>=minNum&&i.remove(parseInt(s[p])):""!=u&&""==minNum?s[p]<=u&&i.remove(parseInt(s[p])):""!=u&&""!=minNum&&(s[p]<=u||s[p]>=minNum)&&i.remove(parseInt(s[p]));$(i).each(function(t){var e=$("rect[qs="+a+"][qi="+i[t]+"][index='0']");"14"!=$(e).attr("width")&&$("rect[qs="+a+"][qi="+i[t]+"][index='0']").attr({fill:"#fff",x:parseInt(e.attr("x"))+22,y:parseInt(e.attr("y"))+12,width:"14",height:"14",rx:"9",ry:"9",stroke:"#B3DE7B","stroke-width":"3","fill-opacity":"1"})})}function propertyBoard(t,e){if(e)return!1;var r=$("#"+t).attr("type");"iSWAP"!=r&&"Measure"!=r&&"RZ"!=r&&"RX"!=r&&"RY"!=r&&"CR"!=r||(isDrag=!1,$(".LayerContent").hide(),$(".LayerSetting").css({top:$("#"+t).offset().top+50,left:$("#"+t).offset().left-$(".LayerSetting").width()/2})),$(".LayerSetting").hide(),$(".LaySetLine1").hide(),$(".LaySetLine3").hide(),$("#commandTip").hide(),$(".LaySetLine2").hide(),$(".LayConfirm").hide(),"H"==r||"NOT"==r||"ZPi"==r||"XPi2"==r||"YPi2"==r||"ZPi2"==r||"CNOT"==r||("iSWAP"==r?($(".LaySetLine3").show(),$("#commandTip").text(messages.commandtip_2),2==analogType?"pi/4"==$("#"+t).attr("operation")||"pi/2"==$("#"+t).attr("operation")||"3*pi/4"==$("#"+t).attr("operation")?$("#property").find("option:contains("+$("#"+t).attr("operation")+")").attr("selected",!0):$("#property").find("option:contains("+$("#"+t).attr("pi/4")+")").attr("selected",!0):$("#property").val($("#"+t).attr("operation")),$("#commandTip").show(),$(".LaySetLine1").show(),$(".LayConfirm").show(),$(".LayerSetting").show()):"Toffoli"==r||("Measure"==r?0==parseInt(analogType)&&($("#commandTip").text(messages.commandtip_1),$("#classicName").val($("#"+t).attr("register")).trigger("change"),$("#commandTip").show(),$(".LaySetLine2").show(),$(".LayConfirm").show(),$(".LayerSetting").show()):"RZ"==r?($("#commandTip").text(messages.commandtip_2),$("#property").val($("#"+t).attr("expression")),$("#commandTip").show(),$(".LaySetLine1").show(),$(".LayConfirm").show(),$(".LayerSetting").show()):"RX"==r?($("#commandTip").text(messages.commandtip_2),$("#property").val($("#"+t).attr("expression")),$("#commandTip").show(),$(".LaySetLine1").show(),$(".LayConfirm").show(),$(".LayerSetting").show()):"RY"==r?($("#commandTip").text(messages.commandtip_2),$("#property").val($("#"+t).attr("expression")),$("#commandTip").show(),$(".LaySetLine1").show(),$(".LayConfirm").show(),$(".LayerSetting").show()):"CR"==r&&($("#commandTip").text(messages.commandtip_2),$("#property").val($("#"+t).attr("expression")),$("#commandTip").show(),$(".LaySetLine1").show(),$(".LayConfirm").show(),$(".LayerSetting").show())))}function buildIdentification(t,e){return null!=e&&""!=e&&(e="<"+e+">"),t=null==t||""==t?e:t+";"+e}function getIdentification(t,e){null!=e&&""!=e&&(e="<"+e+">");for(var r=t.split(";"),n=0,a=0;a<r.length;a++)r[a]==e&&(n+=1);return 1<n}function codeCollection(){$(".Layer_Con .Layer_sort_con").eq(2).find("li").click(function(t){var e=$(this),r=e.attr("id");if($(this).attr("id")!=r?($(".dmhj dd.current").removeClass("current"),$(".commandList dd.current").removeClass("current"),e.addClass("current")):e.removeClass("current"),0<$("rect[focus=true][index='1']").length)return checkGrammar()&&($(this).addClass("current"),$("#svgBoard rect[index='1']").attr("stroke","none"),$("#svgBoard rect[index='0']").attr("stroke","none"),$("rect[focus=true][index='1']").removeAttr("focus")),!1;if(0<$("rect[focus=true][index='0']").length){e.removeClass("current");var n=$("rect[focus=true][index='0']").attr("qi"),a=$("rect[focus=true][index='0']").attr("qs");if(xNum=e.attr("xNum"),yNum=e.attr("yNum"),!isVoid(n,a,xNum,yNum))return!1;$("rect[focus=true][index='0']").attr("fill","#fff"),$("rect[focus=true][index='0']").attr("fill-opacity","0"),$("rect[focus=true][index='0']").attr("r","3"),$("rect[focus=true][index='0']").attr("stroke","none"),$("rect[focus=true][index='0']").removeAttr("focus"),"GHZ2"==r?createGHZ2(n,a):"GHZ3"==r?createGHZ3(n,a):"GHZ6"==r?createGHZ6(n,a):"QFT3"==r?createQFT3(n,a):"QFT4"==r?createQFT4(n,a):"CZ"==r?createCZ(n,a):"z-CNOT"==r?createz_CNOT(n,a):"SWAP"==r?createSWAP(n,a):"H6"==r&&createH6(n,a)}})}function createGHZ2(t,e){var r=$("rect[qi="+t+"][qs="+e+"][index='0']"),n=$("#svg_H g").clone();n.attr("transform","translate("+(parseInt(r.attr("x"))+5)+","+(r.attr("y")-5)+")"),n.find("rect").attr("qi",t),n.find("rect").attr("qs",e),n.find("rect").attr("refcx",r.attr("x")),n.find("rect").attr("refcy",r.attr("y")),n.find("rect").attr("id",t+"-"+e),n.find("rect").attr("type","H"),n.find("rect").attr("onclick","clickImage(evt)"),r.parent().append(n),dragObj(t+"-"+e);var a=$("rect[qi="+(+t+1)+"][qs="+(+e+1)+"][index='0']"),i=$("rect[qi="+t+"][qs="+(+e+1)+"][index='0']"),s=$("#svg_CNOT g").clone();s.attr("transform","translate("+(parseInt(a.attr("x"))+5)+","+(a.attr("y")-5)+")"),s.find("rect").attr("n2","n2-"+t+"-"+(+e+1)),s.find("rect").attr("qi",+t+1),s.find("rect").attr("qs",+e+1),s.find("rect").attr("refcx",i.attr("x")),s.find("rect").attr("refcy",i.attr("y")),s.find("rect").attr("id",+t+1+"-"+(+e+1)),s.find("rect").attr("type","CNOT"),s.find("rect").attr("onclick","clickImage(evt)"),$(a).parent().append(s);var c=document.createElementNS(xmlns,"line");c.setAttribute("n2","n2-"+t+"-"+(+e+1)),c.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),c.setAttribute("fill","#B3DE7B"),c.setAttribute("x1",parseInt(a.attr("x"))+30),c.setAttribute("y1",parseInt(a.attr("y"))),c.setAttribute("x2",parseInt($(s).find("rect").attr("refcx"))+30),c.setAttribute("y2",+$(s).find("rect").attr("refcy")+15),a.parent().append(c),appendRectSvg=appendRect("n2-"+t+"-"+(+e+1),parseInt(i.attr("x"))+21,parseInt(i.attr("y"))+10,t,e,"",""),i.parent().append(appendRectSvg),dragObj(+t+1+"-"+(+e+1))}function createGHZ3(t,e){var r=$("rect[qi="+t+"][qs="+e+"][index='0']"),n=$("#svg_H g").clone();n.attr("transform","translate("+(parseInt(r.attr("x"))+5)+","+(r.attr("y")-5)+")"),$(n).find("rect").attr("qi",t),$(n).find("rect").attr("qs",e),$(n).find("rect").attr("refcx",r.attr("x")),$(n).find("rect").attr("refcy",r.attr("y")),$(n).find("rect").attr("id",t+"-"+e),$(n).find("rect").attr("type","H"),$(n).find("rect").attr("onclick","clickImage(evt)"),r.parent().append(n),dragObj(t+"-"+e);for(var a=1;a<3;a++){var i=$("rect[qi="+(+t+a)+"][qs="+(+e+a)+"][index='0']"),s=$("rect[qi="+(+t+a-1)+"][qs="+(+e+a)+"][index='0']"),c=$("#svg_CNOT g").clone();c.attr("transform","translate("+(parseInt(i.attr("x"))+5)+","+(parseInt(i.attr("y"))-5)+")"),$(c).find("rect").attr("n2","n2-"+(+t+a-1)+"-"+(+e+1)),$(c).find("rect").attr("qi",+t+a),$(c).find("rect").attr("qs",+e+a),$(c).find("rect").attr("refcx",s.attr("x")),$(c).find("rect").attr("refcy",s.attr("y")),$(c).find("rect").attr("id",+t+a+"-"+(+e+a)),$(c).find("rect").attr("type","CNOT"),$(c).find("rect").attr("onclick","clickImage(evt)"),$(i).parent().append(c);var o=document.createElementNS(xmlns,"line");o.setAttribute("n2","n2-"+(+t+a-1)+"-"+(+e+1)),o.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),o.setAttribute("fill","#B3DE7B"),o.setAttribute("x1",parseInt(i.attr("x"))+30),o.setAttribute("y1",parseInt(i.attr("y"))),o.setAttribute("x2",parseInt($(c).find("rect").attr("refcx"))+30),o.setAttribute("y2",+$(c).find("rect").attr("refcy")+15),i.parent().append(o),appendRectSvg=appendRect("n2-"+(+t+a-1)+"-"+(+e+1),parseInt(s.attr("x"))+21,parseInt(s.attr("y"))+10,t,e,"",""),s.parent().append(appendRectSvg),dragObj(+t+a+"-"+(+e+a))}}function createGHZ6(t,e){var r=$("rect[qi="+t+"][qs="+e+"][index='0']"),n=$("#svg_H g").clone();n.attr("transform","translate("+(parseInt(r.attr("x"))+5)+","+(r.attr("y")-5)+")"),$(n).find("rect").attr("qi",t),$(n).find("rect").attr("qs",e),$(n).find("rect").attr("refcx",r.attr("x")),$(n).find("rect").attr("refcy",r.attr("y")),$(n).find("rect").attr("id",t+"-"+e),$(n).find("rect").attr("type","H"),$(n).find("rect").attr("onclick","clickImage(evt)"),r.parent().append(n),dragObj(t+"-"+e);for(var a=1;a<6;a++){var i=$("rect[qi="+(+t+a)+"][index='0'][qs="+(+e+a)+"]"),s=$("rect[qi="+(+t+a-1)+"][index='0'][qs="+(+e+a)+"]"),c=$("#svg_CNOT g").clone();c.attr("transform","translate("+(parseInt(i.attr("x"))+5)+","+(i.attr("y")-5)+")"),$(c).find("rect").attr("n2","n2-"+(+t+a-1)+"-"+(+e+a)),$(c).find("rect").attr("qi",+t+a),$(c).find("rect").attr("qs",+e+a),$(c).find("rect").attr("refcx",s.attr("x")),$(c).find("rect").attr("refcy",s.attr("y")),$(c).find("rect").attr("id",+t+a+"-"+(+e+a)),$(c).find("rect").attr("type","CNOT"),$(c).find("rect").attr("onclick","clickImage(evt)"),$(i).parent().append(c);var o=document.createElementNS(xmlns,"line");o.setAttribute("n2","n2-"+(+t+a-1)+"-"+(+e+a)),o.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),o.setAttribute("fill","#B3DE7B"),o.setAttribute("x1",parseInt(i.attr("x"))+30),o.setAttribute("y1",parseInt(i.attr("y"))),o.setAttribute("x2",parseInt($(c).find("rect").attr("refcx"))+30),o.setAttribute("y2",+$(c).find("rect").attr("refcy")+15),i.parent().append(o),appendRectSvg=appendRect("n2-"+(+t+a-1)+"-"+(+e+a),parseInt(s.attr("x"))+21,parseInt(s.attr("y"))+10,t,e,"",""),s.parent().append(appendRectSvg),dragObj(+t+a+"-"+(+e+a))}}function createQFT3(t,e){for(var r=0,n=0,a=3;0<a;a--){var i=$("rect[qi="+(+t+r)+"][qs="+(+e+n)+"][index='0']");(c=$("#svg_H g").clone()).attr("transform","translate("+(parseInt(i.attr("x"))+5)+","+(i.attr("y")-5)+")"),c.find("rect").attr("qi",+t+r),c.find("rect").attr("qs",+e+n),c.find("rect").attr("refcx",i.attr("x")),c.find("rect").attr("refcy",i.attr("y")),c.find("rect").attr("id",+t+r+"-"+(+e+n)),c.find("rect").attr("type","H"),c.find("rect").attr("onclick","clickImage(evt)"),i.parent().append(c),dragObj(+t+r+"-"+(+e+n)),n++;for(var s=0;s<a-1;s++){var c,o=$("rect[qi="+(+t+r)+"][index='0'][qs="+(+e+n)+"]"),u=$("rect[qi="+(+t+r+s+1)+"][index='0'][qs="+(+e+n)+"]");(c=$("#svg_CR g").clone()).attr("transform","translate("+(parseInt(o.attr("x"))+5)+","+(o.attr("y")-5)+")"),c.find("rect").attr("n2","n2-"+(+t+r+s+1)+"-"+(+e+n)),c.find("rect").attr("qi",+t+r),c.find("rect").attr("qs",+e+n),c.find("rect").attr("refcx",u.attr("x")),c.find("rect").attr("refcy",u.attr("y")),c.find("rect").attr("id",+t+r+"-"+(+e+n)),c.find("rect").attr("type","CR"),c.find("rect").attr("onclick","clickImage(evt)"),c.find("rect").attr("expression","pi/"+(2<<s)),o.parent().append(c);var d=document.createElementNS(xmlns,"line");d.setAttribute("n2","n2-"+(+t+r+s+1)+"-"+(+e+n)),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),d.setAttribute("x1",parseInt(c.find("rect").attr("refcx"))+30),d.setAttribute("y1",parseInt(c.find("rect").attr("refcy"))+15),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",+o.attr("y")+30),u.parent().append(d),appendRectSvg=appendRect("n2-"+(+t+r+s+1)+"-"+(+e+n),parseInt(u.attr("x"))+21,parseInt(u.attr("y"))+10,+t+r+s+1,+e+n,"",""),u.parent().append(appendRectSvg),dragObj(+t+r+"-"+(+e+n)),n++}r++}}function createQFT4(t,e){for(var r=0,n=0,a=4;0<a;a--){var i=$("rect[qi="+(+t+r)+"][qs="+(+e+n)+"][index='0']");(c=$("#svg_H g").clone()).attr("transform","translate("+(parseInt(i.attr("x"))+5)+","+(i.attr("y")-5)+")"),c.find("rect").attr("qi",+t+r),c.find("rect").attr("qs",+e+n),c.find("rect").attr("refcx",i.attr("x")),c.find("rect").attr("refcy",i.attr("y")),c.find("rect").attr("id",+t+r+"-"+(+e+n)),c.find("rect").attr("type","H"),c.find("rect").attr("onclick","clickImage(evt)"),i.parent().append(c),dragObj(+t+r+"-"+(+e+n)),n++;for(var s=0;s<a-1;s++){var c,o=$("rect[qi="+(+t+r)+"][index='0'][qs="+(+e+n)+"]"),u=$("rect[qi="+(+t+r+s+1)+"][index='0'][qs="+(+e+n)+"]");(c=$("#svg_CR g").clone()).attr("transform","translate("+(parseInt(o.attr("x"))+5)+","+(o.attr("y")-5)+")"),c.find("rect").attr("n2","n2-"+(+t+r+s+1)+"-"+(+e+n)),c.find("rect").attr("qi",+t+r),c.find("rect").attr("qs",+e+n),c.find("rect").attr("refcx",u.attr("x")),c.find("rect").attr("refcy",u.attr("y")),c.find("rect").attr("id",+t+r+"-"+(+e+n)),c.find("rect").attr("type","CR"),c.find("rect").attr("onclick","clickImage(evt)"),c.find("rect").attr("expression","pi/"+(2<<s)),o.parent().append(c);var d=document.createElementNS(xmlns,"line");d.setAttribute("n2","n2-"+(+t+r+s+1)+"-"+(+e+n)),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),d.setAttribute("x1",parseInt(c.find("rect").attr("refcx"))+30),d.setAttribute("y1",parseInt(c.find("rect").attr("refcy"))+15),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",+o.attr("y")+30),u.parent().append(d),appendRectSvg=appendRect("n2-"+(+t+r+s+1)+"-"+(+e+n),parseInt(u.attr("x"))+21,parseInt(u.attr("y"))+10,+t+r+s+1,+e+n,"",""),u.parent().append(appendRectSvg),dragObj(+t+r+"-"+(+e+n)),n++}r++}}function createCZ(t,e){var r=$("rect[qi="+(+t+1)+"][qs="+e+"][index='0']"),n=$("#svg_H g").clone();n.attr("transform","translate("+(parseInt(r.attr("x"))+5)+","+(r.attr("y")-5)+")"),n.find("rect").attr("qi",+t+1),n.find("rect").attr("qs",e),n.find("rect").attr("refcx",r.attr("x")),n.find("rect").attr("refcy",r.attr("y")),n.find("rect").attr("id",+t+1+"-"+e),n.find("rect").attr("type","H"),n.find("rect").attr("onclick","clickImage(evt)"),r.parent().append(n),dragObj(+t+1+"-"+e);var a=$("rect[qi="+(+t+1)+"][index='0'][qs="+(+e+1)+"]"),i=$("rect[qi="+t+"][index='0'][qs="+(+e+1)+"]"),s=$("#svg_CNOT g").clone();s.attr("transform","translate("+(parseInt(a.attr("x"))+5)+","+(a.attr("y")-5)+")"),s.find("rect").attr("n2","n2-"+t+"-"+(+e+1)),s.find("rect").attr("qi",+t+1),s.find("rect").attr("qs",+e+1),s.find("rect").attr("refcx",i.attr("x")),s.find("rect").attr("refcy",i.attr("y")),s.find("rect").attr("id",+t+1+"-"+(+e+1)),s.find("rect").attr("type","CNOT"),s.find("rect").attr("onclick","clickImage(evt)"),$(a).parent().append(s);var c=document.createElementNS(xmlns,"line");c.setAttribute("n2","n2-"+t+"-"+(+e+1)),c.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),c.setAttribute("fill","#B3DE7B"),c.setAttribute("x1",parseInt(a.attr("x"))+30),c.setAttribute("y1",parseInt(a.attr("y"))),c.setAttribute("x2",parseInt($(s).find("rect").attr("refcx"))+30),c.setAttribute("y2",+$(s).find("rect").attr("refcy")+15),a.parent().append(c),appendRectSvg=appendRect("n2-"+t+"-"+(+e+1),parseInt(i.attr("x"))+21,parseInt(i.attr("y"))+10,t,+e+1,"",""),i.parent().append(appendRectSvg),dragObj(+t+1+"-"+(+e+1));var o=$("rect[qi="+(+t+1)+"][index='0'][qs="+(+e+2)+"]"),u=$("#svg_H g").clone();u.attr("transform","translate("+(parseInt(o.attr("x"))+5)+","+(o.attr("y")-5)+")"),u.find("rect").attr("qi",+t+1),u.find("rect").attr("qs",+e+2),u.find("rect").attr("refcx",o.attr("x")),u.find("rect").attr("refcy",o.attr("y")),u.find("rect").attr("id",+t+1+"-"+(+e+2)),u.find("rect").attr("type","H"),u.find("rect").attr("onclick","clickImage(evt)"),o.parent().append(u),dragObj(+t+1+"-"+(+e+2))}function createz_CNOT(t,e){var r=$("rect[qi="+t+"][qs="+e+"][index='0']"),n=$("#svg_NOT g").clone();n.attr("transform","translate("+(parseInt(r.attr("x"))+5)+","+(r.attr("y")-5)+")"),n.find("rect").attr("qi",t),n.find("rect").attr("qs",e),n.find("rect").attr("refcx",r.attr("x")),n.find("rect").attr("refcy",r.attr("y")),n.find("rect").attr("id",t+"-"+e),n.find("rect").attr("type","NOT"),n.find("rect").attr("onclick","clickImage(evt)"),r.parent().append(n),dragObj(+t+1+"-"+e);var a=$("rect[qi="+(+t+1)+"][index='0'][qs="+(+e+1)+"]"),i=$("rect[qi="+t+"][index='0'][qs="+(+e+1)+"]"),s=$("#svg_CNOT g").clone();s.attr("transform","translate("+(parseInt(a.attr("x"))+5)+","+(a.attr("y")-5)+")"),s.find("rect").attr("n2","n2-"+t+"-"+(+e+1)),s.find("rect").attr("qi",+t+1),s.find("rect").attr("qs",+e+1),s.find("rect").attr("refcx",i.attr("x")),s.find("rect").attr("refcy",i.attr("y")),s.find("rect").attr("id",+t+1+"-"+(+e+1)),s.find("rect").attr("type","CNOT"),s.find("rect").attr("onclick","clickImage(evt)"),$(a).parent().append(s);var c=document.createElementNS(xmlns,"line");c.setAttribute("n2","n2-"+t+"-"+(+e+1)),c.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),c.setAttribute("fill","#B3DE7B"),c.setAttribute("x1",parseInt(a.attr("x"))+30),c.setAttribute("y1",parseInt(a.attr("y"))),c.setAttribute("x2",parseInt($(s).find("rect").attr("refcx"))+30),c.setAttribute("y2",+$(s).find("rect").attr("refcy")+15),a.parent().append(c),appendRectSvg=appendRect("n2-"+t+"-"+(+e+1),parseInt(i.attr("x"))+21,parseInt(i.attr("y"))+10,t,+e+1,"",""),i.parent().append(appendRectSvg),dragObj(+t+1+"-"+(+e+1));var o=$("rect[qi="+t+"][index='0'][qs="+(+e+2)+"]"),u=$("#svg_NOT g").clone();u.attr("transform","translate("+(parseInt(o.attr("x"))+5)+","+(o.attr("y")-5)+")"),u.find("rect").attr("qi",t),u.find("rect").attr("qs",+e+2),u.find("rect").attr("refcx",o.attr("x")),u.find("rect").attr("refcy",o.attr("y")),u.find("rect").attr("id",t+"-"+(+e+2)),u.find("rect").attr("type","NOT"),u.find("rect").attr("onclick","clickImage(evt)"),o.parent().append(u),dragObj(t+"-"+(+e+2))}function createSWAP(t,e){var r=$("rect[qi="+t+"][qs="+e+"][index='0']"),n=$("rect[qi="+(+t+1)+"][qs="+e+"][index='0']"),a=$("#svg_CNOT g").clone();a.attr("transform","translate("+(parseInt(r.attr("x"))+5)+","+(r.attr("y")-5)+")"),a.find("rect").attr("n2","n2-"+(+t+1)+"-"+e),a.find("rect").attr("qi",t),a.find("rect").attr("qs",e),a.find("rect").attr("refcx",n.attr("x")),a.find("rect").attr("refcy",n.attr("y")),a.find("rect").attr("id",t+"-"+e),a.find("rect").attr("type","CNOT"),a.find("rect").attr("onclick","clickImage(evt)"),$(r).parent().append(a);var i=document.createElementNS(xmlns,"line");i.setAttribute("n2","n2-"+(+t+1)+"-"+e),i.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),i.setAttribute("fill","#B3DE7B"),i.setAttribute("x1",parseInt(a.find("rect").attr("refcx"))+30),i.setAttribute("y1",+parseInt(a.find("rect").attr("refcy"))+15),i.setAttribute("x2",parseInt(r.attr("x"))+30),i.setAttribute("y2",+parseInt(r.attr("y"))+35),n.parent().append(i);var s=document.createElementNS(xmlns,"rect");s.setAttribute("id","n2-"+(+t+1)+"-"+e),s.setAttribute("x",parseInt(n.attr("x"))+21),s.setAttribute("y",parseInt(n.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r",9),s.setAttribute("qi",+t+1),s.setAttribute("qs",e),s.setAttribute("fill","#B3DE7B"),n.parent().append(s),dragObj(+t+1+"-"+e);var c=$("rect[qi="+(+t+1)+"][index='0'][qs="+(+e+1)+"]"),o=$("rect[qi="+t+"][index='0'][qs="+(+e+1)+"]"),u=$("#svg_CNOT g").clone();u.attr("transform","translate("+(parseInt(c.attr("x"))+5)+","+(c.attr("y")-5)+")"),u.find("rect").attr("n2","n2-"+t+"-"+(+e+1)),u.find("rect").attr("qi",+t+1),u.find("rect").attr("qs",+e+1),u.find("rect").attr("refcx",o.attr("x")),u.find("rect").attr("refcy",o.attr("y")),u.find("rect").attr("id",+t+1+"-"+(+e+1)),u.find("rect").attr("type","CNOT"),u.find("rect").attr("onclick","clickImage(evt)"),$(c).parent().append(u);var d=document.createElementNS(xmlns,"line");d.setAttribute("n2","n2-"+t+"-"+(+e+1)),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),d.setAttribute("x1",parseInt(c.attr("x"))+30),d.setAttribute("y1",+parseInt(c.attr("y"))),d.setAttribute("x2",parseInt(u.find("rect").attr("refcx"))+30),d.setAttribute("y2",+parseInt(u.find("rect").attr("refcy"))+20),c.parent().append(d);var p=document.createElementNS(xmlns,"rect");p.setAttribute("id","n2-"+t+"-"+(+e+1)),p.setAttribute("x",parseInt(o.attr("x"))+21),p.setAttribute("y",parseInt(o.attr("y"))+10),p.setAttribute("width",18),p.setAttribute("height",18),p.setAttribute("rx",9),p.setAttribute("ry",9),p.setAttribute("index","1"),p.setAttribute("r",9),p.setAttribute("qi",t),p.setAttribute("qs",+e+1),p.setAttribute("fill","#B3DE7B"),o.parent().append(p),dragObj(+t+1+"-"+(+e+1));var f=$("rect[qi="+t+"][index='0'][qs="+(+e+2)+"]"),l=$("rect[qi="+(+t+1)+"][index='0'][qs="+(+e+2)+"]"),m=$("#svg_CNOT g").clone();m.attr("transform","translate("+(parseInt(f.attr("x"))+5)+","+(f.attr("y")-5)+")"),m.find("rect").attr("n2","n2-"+(+t+1)+"-"+(+e+2)),m.find("rect").attr("qi",t),m.find("rect").attr("qs",+e+2),m.find("rect").attr("refcx",l.attr("x")),m.find("rect").attr("refcy",l.attr("y")),m.find("rect").attr("id",t+"-"+(+e+2)),m.find("rect").attr("type","CNOT"),m.find("rect").attr("onclick","clickImage(evt)"),$(f).parent().append(m);var g=document.createElementNS(xmlns,"line");g.setAttribute("n2","n2-"+(+t+1)+"-"+(+e+2)),g.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),g.setAttribute("fill","#B3DE7B"),g.setAttribute("x1",parseInt(m.find("rect").attr("refcx"))+30),g.setAttribute("y1",+parseInt(m.find("rect").attr("refcy"))+15),g.setAttribute("x2",parseInt(f.attr("x"))+30),g.setAttribute("y2",+parseInt(f.attr("y"))+35),l.parent().append(g);var x=document.createElementNS(xmlns,"rect");x.setAttribute("id","n2-"+(+t+1)+"-"+(+e+2)),x.setAttribute("x",parseInt(l.attr("x"))+21),x.setAttribute("y",parseInt(l.attr("y"))+10),x.setAttribute("width",18),x.setAttribute("height",18),x.setAttribute("rx",9),x.setAttribute("ry",9),x.setAttribute("index","1"),x.setAttribute("r",9),x.setAttribute("qi",+t+1),x.setAttribute("qs",+e+2),x.setAttribute("fill","#B3DE7B"),l.parent().append(x),dragObj(t+"-"+(+e+2))}function createH6(t,e){for(var r=0;r<6;r++){var n=$("rect[qi="+(+t+r)+"][qs="+e+"][index='0']"),a=$("#svg_H g").clone();a.attr("transform","translate("+(parseInt(n.attr("x"))+5)+","+(n.attr("y")-5)+")"),a.find("rect").attr("qi",+t+r),a.find("rect").attr("qs",e),a.find("rect").attr("refcx",n.attr("x")),a.find("rect").attr("refcy",n.attr("y")),a.find("rect").attr("id",+t+r+"-"+e),a.find("rect").attr("type","H"),a.find("rect").attr("onclick","clickImage(evt)"),n.parent().append(a),dragObj(+t+r+"-"+e)}}function isVoid(t,e,r,n){var a=+t,i=+e,s=+n+a,c=+r+i;if(qubitNum<s){var o=messages.beyond_the_number_of_qubits;return prompt(o.substring(0,o.length-2)),!1}for(;a<s;a++){var u=-1,d="";if($("rect[qi="+a+"][index='0']").each(function(){var t=$(this).attr("qs"),e=a+"-"+t;0<$("#"+e).length&&"Measure"==$("#"+e).attr("type")&&(u=t)}),-1!=parseInt(u)&&parseInt(u)<=parseInt(e))return prompt(messages.measure_is_end),checkCircle(),!1;for(i=+e;i<c;i++){d=a+"-"+i;if(0<$("#"+d).length)return prompt(messages.icons_not_allowed),!1;if(0<$("#n2-"+d).length)return prompt(messages.icons_not_allowed),!1}}return!0}function transCode(){for(var t=!0,e="",r="",n=1;n<=stepNum;n++)for(var a=0;a<lineNum;a++)if(0!=$("#"+a+"-"+n).length){var i=$("#"+a+"-"+n),s=$(i).attr("type");if("RX"==s)"pi/4"==(c=$(i).attr("expression"))?r="X1":"pi/2"==c?r="X2":"3*pi/4"==c&&(r="X3"),t?(e+='{"type": "'+r+'","qBit1": '+a+"}",t=!1):e+=',{"type": "'+r+'","qBit1": '+a+"}";else if("RY"==s){var c;"pi/4"==(c=$(i).attr("expression"))?r="Y1":"pi/2"==c?r="Y2":"3*pi/4"==c&&(r="Y3"),t?(e+='{"type": "'+r+'","qBit1": '+a+"}",t=!1):e+=',{"type": "'+r+'","qBit1": '+a+"}"}else if("iSWAP"==s){var o=$("#"+$(i).attr("n2")).attr("qi");$(i).attr("operation");t?(e+='{"type": "iSWAP","qBit1": '+a+',"qBit2": '+o+",}",t=!1):e+=',{"type": "iSWAP","qBit1": '+a+',"qBit2": '+o+",}"}}return e}Array.prototype.remove=function(t){var e=this.indexOf(t);-1<e&&this.splice(e,1)};var currentQi,currentQs,LineTime=null,LineI=0,LineArray=["black","green","cyan","blue","purple "],qubitNum=(xmlns="http://www.w3.org/2000/svg",""),totalRows=qubitNum,totalCols=100,yx="",xIndex=0,yIndex=1,hash={},codeArr2=[],clearQubitTime=null,regNotes=/^%.*$/;function code2Trans(t){clearTimeout(clearQubitTime);var e="";if(hash={},null!=t&&""!=t)e=t;else{if(null==codeMirror||null==codeMirror)return;e=codeMirror.getValue()}""==e&&initTemplate();var r=!0,n=e.split("\n");if(codeArr2=e.split("\n"),initTemplate(n.length),$.each(n,function(t,e){if(18<=yIndex)return!1;if(codeArr2.shift(),e){if(regNotes.test(e))return!0;if(void 0!==(r=checkCodeItems(e,t+1))&&1!=r)return r=!1}}),clearQubitTime=setTimeout(function(){lastArray()},400),100<n.length){for(var a="",i=1;i<=n.length;i++)a+="<li>"+i+"</li>";$(".modRight_top ul").html(a)}return r}function lastArray(){var r="";return $.each(codeArr2,function(t,e){if(e){if(regNotes.test(e))return!0;if(void 0!==(r=checkCodeItems(e,t+1))&&1!=r)return r=!1}}),codeArr2=[],r}function checkCodeItems(t,e){var r=checkCode(t);if(""==r||-1==r)return prompt(messages.compile_error+e),!1;var n=getCoordinates(t,r);if(!checkRepeat(n,e))return!1;switch(r){case 10:return createRect(n,"H",t,e);case 20:return createRect(n,"NOT",t,e);case 21:return createRect(n,"XPi2",t,e);case 22:return createRect(n,"RX",t,e);case 30:return createRect(n,"ZPi",t,e);case 31:return createRect(n,"ZPi2",t,e);case 32:return createRect(n,"RZ",t,e);case 40:return createRect(n,"YPi2",t,e);case 41:return createRect(n,"RY",t,e);case 50:return createRect(n,"CNOT",t,e);case 60:return createRect(n,"iSWAP",t,e);case 70:return createRect(n,"Toffoli",t,e);case 80:if(0==parseInt(analogType))return createRect(n,"Measure",t,e);for(var a=new Array,i=0;i<n.length;i++){if(parseInt(n[i])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+e),!1;if(a[0]=n[i],0==createRect(a,"Measure",t,e))return!1}break;case 90:return createRect(n,"CR",t,e)}}function checkCode(t){return 0==t.indexOf("H")?/^H+\s((?!0)\d{1,3}|0)$/.test(t)?10:-1:0==t.indexOf("RX")?/^RX+\s((?!0)\d{1,3}|0),\"(pi|PI)\"$/.test(t)?20:/^RX+\s((?!0)\d{1,3}|0),\"(pi|PI)[\/\/]2\"$/.test(t)?21:/^RX+\s((?!0)\d{1,3}|0),\"\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*\"$/.test(t)?"."==t.substring(t.length-2,t.length-1)?-1:22:-1:0==t.indexOf("RZ")?/^RZ+\s((?!0)\d{1,3}|0),\"(pi|PI)\"$/.test(t)?30:/^RZ+\s((?!0)\d{1,3}|0),\"(pi|PI)[\/\/]2\"$/.test(t)?31:/^RZ+\s((?!0)\d{1,3}|0),\"\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*\"$/.test(t)?"."==t.substring(t.length-2,t.length-1)?-1:32:-1:0==t.indexOf("RY")?/^RY+\s((?!0)\d{1,3}|0),\"(pi|PI)[\/\/]2\"$/.test(t)?40:/^RY+\s((?!0)\d{1,3}|0),\"\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*\"$/.test(t)?"."==t.substring(t.length-2,t.length-1)?-1:41:-1:0==t.indexOf("CNOT")?/^CNOT+\s((?!0)\d{1,3}|0),((?!0)\d{1,3}|0)$/.test(t)?50:-1:0==t.indexOf("ISWAP")||0==t.indexOf("SQISWAP")?/^ISWAP+\s((?!0)\d{1,3}|0),((?!0)\d{1,3}|0),\"\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*\"$/.test(t)?60:-1:0==t.indexOf("TOFFOLI")?/^TOFFOLI+\s((?!0)\d{1,3}|0),((?!0)\d{1,3}|0),((?!0)\d{1,3}|0)$/.test(t)?70:-1:0==t.indexOf("MEASURE")||0==t.indexOf("PMEASURE")?0==parseInt(analogType)||2==parseInt(analogType)?/^MEASURE+\s((?!0)\d{1,3}|0),\$[\d]{1,3}$/.test(t)?80:-1:/^PMEASURE\s[\d\,]{0,}\d+$/.test(t)?80:-1:0!=t.indexOf("CR")?-1:/^CR+\s((?!0)\d{1,3}|0),((?!0)\d{1,3}|0),\"([(\d\.\-)]{1,200}|[(\-)(pi|PI)]{3}|[(pi|PI)]{2})[\+\-\*\/\^]*[\d+(\.\d+)]{1,200}\"$/.test(t)?"."==t.substring(t.length-2,t.length-1)?-1:90:-1}function getCoordinates(t,e){try{if(21==e||31==e||40==e){t=t.replace(/\"(pi|PI)[\/]2\"$/,"")}else if(22==e||32==e||41==e||90==e){t=t.replace(/\"((\+|\-)?((\d+(\.\d*)?)?|(pi|PI){1}))([\+\-\*\/\^]{1}((\+|\-)?((\d+(\.\d*)?)?|(pi|PI){1})))*\"$/,"")}else if(80==e){t=t.replace(/\$[\d]$/,"")}else if(60==e){t=t.replace(/\"\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*\"$/,"")}for(var r=t.replace(/[^0-9$]/gi,",").split(","),n=new Array,a=0;a<r.length;a++)r[a]+""!=""&&(n[n.length]=r[a]);return n}catch(t){prompt(t)}}var currentType,currentX,currentY,scrollTop,isInit=!0;function createRect(t,e,r,n){if(!(parseInt(yIndex)>parseInt(totalCols))){for(var a=0;a<t.length;a++)if(parseInt(t[a])>=parseInt(qubitNum))return prompt(messages.expression_is_not_legal),!1;var i=$("#svg_"+e+" g").clone();if("CNOT"==e||"CR"==e||"iSWAP"==e||"Toffoli"==e)if(0==xIndex&&1==yIndex&&1==isInit){if(parseInt(t[t.length-1])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;if(yx=t[t.length-1]+"-"+yIndex,!($("#"+yx).length<=0))return prompt(messages.bit_gate_already_existed+n),!1;$("rect[index='0']").attr("focus","false"),checkCircle();var s=$("rect[qs="+yIndex+"][index='0'][qi="+t[t.length-1]+"]");if($(s).attr("focus","true"),$(s).attr("r","9"),$(s).attr("stroke","none"),$(s).attr("fill","#fff"),$(s).attr("fill-opacity","0"),xIndex=t[t.length-1],$("rect[focus=true][index='1']").attr("focus","false").attr("stroke","none"),i.attr("transform","translate("+(parseInt($("rect[focus=true][index='0']").attr("x"))+5)+","+($("rect[focus=true][index='0']").attr("y")-5)+")"),$(i).find("rect").attr("stroke","black"),$(i).find("rect").attr("stroke-width","1"),$(i).find("rect").attr("qi",xIndex),$(i).find("rect").attr("qs",yIndex),$(i).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")),$(i).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")),$(i).find("rect").attr("id",xIndex+"-"+yIndex),$(i).find("rect").attr("type",e),$(i).find("rect").attr("focus","true"),$("rect[focus=true][index='0']").parent().append(i),"iSWAP"==e)for(var c=0;c<t.length-1;c++){if(parseInt(t[c])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;var o=$("rect[qi="+t[c]+"][index='0'][qs="+yIndex+"]");(d=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+t[c]+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),xIndex=parseInt(t[c])>parseInt(t[t.length-1])?($(o).parent().append(d),t[c]):($(i).parent().append(d),t[t.length-1]),(u=$("#svg_iSWAP g").clone()).attr("transform","translate("+(parseInt(o.attr("x"))+5)+","+(parseInt(o.attr("y"))-5)+")"),$(u).find("rect").attr("qi",t[c]),$(u).find("rect").attr("qs",yIndex),$(u).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")),$(u).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")),$(u).find("rect").attr("id","n2-"+t[c]+"-"+yIndex),$(u).find("rect").attr("type",e),$(u).find("rect").attr("refid",t[c]+"-"+yIndex),parseInt(t[c])>parseInt(t[t.length-1])?$(o).parent().append(u):$(i).parent().append(u),$(i).find("rect[focus=true][index='1']").attr("n2","n2-"+t[c]+"-"+yIndex)}else if("Toffoli"==e){for(c=0;c<t.length-1;c++){if(parseInt(t[c])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;o=$("rect[qi="+t[c]+"][index='0'][qs="+yIndex+"]");if(parseInt(c+1)<parseInt(t.length-1))(s=document.createElementNS(xmlns,"rect")).setAttribute("id","n2-"+t[c]+"-"+yIndex),s.setAttribute("x",parseInt(o.attr("x"))+21),s.setAttribute("y",parseInt(o.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r","9"),s.setAttribute("qi",t[c]),s.setAttribute("qs",yIndex),s.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(s),(d=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+t[c]+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>=parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))-0),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(d),$(i).find("rect[focus=true]").attr("n2","n2-"+t[c]+"-"+yIndex);else if(parseInt(c+1)==parseInt(t.length-1)){(s=document.createElementNS(xmlns,"rect")).setAttribute("id","n3-"+xIndex+"-"+yIndex),s.setAttribute("x",parseInt(o.attr("x"))+21),s.setAttribute("y",parseInt(o.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r","9"),s.setAttribute("qi",t[c]),s.setAttribute("qs",yIndex),s.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(s),(d=document.createElementNS(xmlns,"line")).setAttribute("n3","n3-"+xIndex+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>=parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))-0),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(d),$(i).find("rect[focus=true]").attr("n3","n3-"+xIndex+"-"+yIndex)}}xIndex=Math.max.apply(null,t)}else for(c=0;c<t.length-1;c++){if(parseInt(t[c])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;o=$("rect[qi="+t[c]+"][index='0'][qs="+yIndex+"]");(s=document.createElementNS(xmlns,"rect")).setAttribute("id","n2-"+t[c]+"-"+yIndex),s.setAttribute("x",parseInt(o.attr("x"))+21),s.setAttribute("y",parseInt(o.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r","9"),s.setAttribute("qi",t[c]),s.setAttribute("qs",yIndex),s.setAttribute("fill","#B3DE7B"),$(o).parent().append(s),(d=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+t[c]+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),xIndex=parseInt(t[c])>parseInt(t[t.length-1])?($(o).parent().append(d),t[c]):($(i).parent().append(d),t[t.length-1]),$(i).find("rect[focus=true][index='1']").attr("n2","n2-"+t[c]+"-"+yIndex)}isInit=!1}else{if(parseInt(t[t.length-1])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;if(parseInt(Math.min.apply(null,t))<=parseInt(xIndex)&&parseInt(yIndex)<=parseInt(totalCols)&&yIndex++,xIndex=t[t.length-1],yx=t[t.length-1]+"-"+yIndex,!($("#"+yx).length<=0))return prompt(messages.bit_gate_already_existed+n),!1;$("rect[index='0']").attr("focus","false"),checkCircle();s=$("rect[qs="+yIndex+"][index='0'][qi="+t[t.length-1]+"]");if($(s).attr("focus","true"),$(s).attr("r","9"),$(s).attr("stroke","none"),$(s).attr("fill","#fff"),$(s).attr("fill-opacity","0"),!checkMeasureLocation(currentQi=xIndex,currentQs=yIndex,n))return!1;if($("rect[focus=true][index='1']").attr("focus","false").attr("stroke","none"),i.attr("transform","translate("+(parseInt($("rect[focus=true][index='0']").attr("x"))+5)+","+($("rect[focus=true][index='0']").attr("y")-5)+")"),$(i).find("rect").attr("stroke","none"),$(i).find("rect").attr("stroke-width","1"),$(i).find("rect").attr("qi",xIndex),$(i).find("rect").attr("qs",yIndex),$(i).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")),$(i).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")),$(i).find("rect").attr("id",xIndex+"-"+yIndex),$(i).find("rect").attr("type",e),$(i).find("rect").attr("focus","true"),$("rect[focus=true][index='0']").parent().append(i),"iSWAP"==e)for(c=0;c<t.length-1;c++){if(parseInt(t[c])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;if(!checkMeasureLocation(t[c],yIndex,n))return!1;var u;o=$("rect[qi="+t[c]+"][index='0'][qs="+yIndex+"]");(d=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+t[c]+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))-0),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),xIndex=parseInt(t[c])>parseInt(t[t.length-1])?($(o).parent().append(d),t[c]):($(i).parent().append(d),t[t.length-1]),(u=$("#svg_iSWAP g").clone()).attr("transform","translate("+(parseInt(o.attr("x"))+5)+","+(o.attr("y")-5)+")"),$(u).find("rect").attr("qi",t[c]),$(u).find("rect").attr("qs",yIndex),$(u).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")),$(u).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")),$(u).find("rect").attr("id","n2-"+t[c]+"-"+yIndex),$(u).find("rect").attr("type",e),$(u).find("rect").attr("refid",t[c]+"-"+yIndex),parseInt(t[c])>parseInt(t[t.length-1])?$(o).parent().append(u):$(i).parent().append(u),$(i).find("rect[focus=true][index='1']").attr("n2","n2-"+t[c]+"-"+yIndex)}else if("Toffoli"==e){for(c=0;c<t.length-1;c++){if(parseInt(t[c])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;if(!checkMeasureLocation(t[c],yIndex,n))return!1;o=$("rect[qi="+t[c]+"][index='0'][qs="+yIndex+"]");if(parseInt(c+1)<parseInt(t.length-1))(s=document.createElementNS(xmlns,"rect")).setAttribute("id","n2-"+t[c]+"-"+yIndex),s.setAttribute("x",parseInt(o.attr("x"))+21),s.setAttribute("y",parseInt(o.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r",9),s.setAttribute("qi",t[c]),s.setAttribute("qs",yIndex),s.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(s),(d=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+t[c]+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>=parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))-0),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(d),$(i).find("rect[focus=true][index='1']").attr("n2","n2-"+t[c]+"-"+yIndex);else if(parseInt(c+1)==parseInt(t.length-1)){(s=document.createElementNS(xmlns,"rect")).setAttribute("id","n3-"+xIndex+"-"+yIndex),s.setAttribute("x",parseInt(o.attr("x"))+21),s.setAttribute("y",parseInt(o.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r",9),s.setAttribute("qi",t[c]),s.setAttribute("qs",yIndex),s.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(s),(d=document.createElementNS(xmlns,"line")).setAttribute("n3","n3-"+xIndex+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>=parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))-0),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),$("rect[focus=true][index='0']").parent().parent().append(d),$(i).find("rect[focus=true][index='1']").attr("n3","n3-"+xIndex+"-"+yIndex)}}xIndex=Math.max.apply(null,t)}else for(c=0;c<t.length-1;c++){if(parseInt(t[c])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;if(!checkMeasureLocation(t[c],yIndex,n))return!1;var d;o=$("rect[qi="+t[c]+"][index='0'][qs="+yIndex+"]");(s=document.createElementNS(xmlns,"rect")).setAttribute("id","n2-"+t[c]+"-"+yIndex),s.setAttribute("x",parseInt(o.attr("x"))+21),s.setAttribute("y",parseInt(o.attr("y"))+10),s.setAttribute("width",18),s.setAttribute("height",18),s.setAttribute("rx",9),s.setAttribute("ry",9),s.setAttribute("index","1"),s.setAttribute("r",9),s.setAttribute("qi",o.attr("qi")),s.setAttribute("qs",o.attr("qs")),s.setAttribute("fill","#B3DE7B"),$(o).parent().append(s),(d=document.createElementNS(xmlns,"line")).setAttribute("n2","n2-"+t[c]+"-"+yIndex),d.setAttribute("x1",parseInt($("rect[focus=true][index='0']").attr("x"))+30),parseInt(t[c])>parseInt(t[t.length-1])?d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+37):d.setAttribute("y1",parseInt($("rect[focus=true][index='0']").attr("y"))+0),d.setAttribute("x2",parseInt(o.attr("x"))+30),d.setAttribute("y2",parseInt(o.attr("y"))+20),d.setAttribute("style","stroke:#B3DE7B;stroke-width:6"),d.setAttribute("fill","#B3DE7B"),xIndex=parseInt(t[c])>parseInt(t[t.length-1])?($(o).parent().append(d),t[c]):($(i).parent().append(d),t[t.length-1]),$(i).find("rect[focus=true][index='1']").attr("n2","n2-"+t[c]+"-"+yIndex)}}else{if(parseInt(t[0])>=parseInt(totalRows))return prompt(messages.beyond_the_number_of_qubits+n),!1;if(0==xIndex&&1==yIndex&&1==isInit){if(yx=yIndex+"-"+t[0],$("#"+yx).length<=0){$("rect[index='0']").attr("focus","false"),checkCircle();s=$("rect[qs="+yIndex+"][index='0'][qi="+t[0]+"]");$(s).attr("focus","true"),$(s).attr("r","7"),$(s).attr("stroke","none"),$(s).attr("fill","#fff"),$(s).attr("fill-opacity","0"),xIndex=t[0]}isInit=!1}else if(parseInt(t[0])<=parseInt(xIndex)&&parseInt(yIndex)<=parseInt(totalCols)&&yIndex++,xIndex=t[0],yx=xIndex+"-"+yIndex,$("#"+yx).length<=0){$("rect[index='0']").attr("focus","false"),checkCircle();s=$("rect[qs="+yIndex+"][index='0'][qi="+t[0]+"]");$(s).attr("focus","true"),$(s).attr("r","7"),$(s).attr("stroke","none"),$(s).attr("fill","#fff"),$(s).attr("fill-opacity","0"),xIndex=t[0]}if(0<$("#"+yx).length)return prompt(messages.bit_gate_already_existed+n),!1;if("Measure"==e){currentQi=xIndex,currentQs=yIndex;var p=-1,f="",l=!1;if($("rect[qi="+currentQi+"][index='0']").each(function(){var t=$(this).attr("qs");if(f=currentQi+"-"+t,0<$("#"+f).length&&(p=t,"Measure"==$("#"+f).attr("type")))return l?void 0:!(l=!0)}),parseInt(currentQs)<=parseInt(p))return prompt(messages.measure_is_end_in_line+n),!1;if(l)return prompt(messages.measure_is_only_in_line+n),!1}else{currentQi=xIndex,currentQs=yIndex;p=-1,f="",l=!1;if($("rect[qi="+currentQi+"][index='0']").each(function(){var t=$(this).attr("qs");f=currentQi+"-"+t,0<$("#"+f).length&&"Measure"==$("#"+f).attr("type")&&(p=t)}),-1!=parseInt(p)&&parseInt(p)<=parseInt(currentQs))return prompt(messages.measure_is_end_in_line+n),!1}$("rect[focus=true][index='1']").attr("focus","false").attr("stroke","none"),i.attr("transform","translate("+(parseInt($("rect[focus=true][index='0']").attr("x"))+5)+","+($("rect[focus=true][index='0']").attr("y")-5)+")"),$(i).find("rect").attr("stroke","black"),$(i).find("rect").attr("stroke-width","1"),$(i).find("rect").attr("qi",xIndex),$(i).find("rect").attr("qs",yIndex),$(i).find("rect").attr("refcx",$("rect[focus=true][index='0']").attr("x")),$(i).find("rect").attr("refcy",$("rect[focus=true][index='0']").attr("y")),$(i).find("rect").attr("id",xIndex+"-"+yIndex),$(i).find("rect").attr("type",e),$(i).find("rect").attr("focus","true"),$("rect[focus=true][index='0']").parent().append(i)}if($(i).attr("onclick","clickImage(evt)"),"RZ"==e||"RX"==e||"RY"==e||"CR"==e){var m=new RegExp(/\"((\+|\-)?((\d+(\.\d*)?)?|(pi|PI){1}))([\+\-\*\/\^]{1}((\+|\-)?((\d+(\.\d*)?)?|(pi|PI){1})))*\"$/),g=r.match(m);$(i).find("rect").attr("expression",g[0].replace(/\"/g,""))}else if("Measure"==e)0==parseInt(analogType)?$(i).find("rect").attr("register",r.split(",")[1]):$(i).find("rect").attr("register",xIndex);else if("iSWAP"==e){m=new RegExp(/\"\-*((pi|PI)|\d+(\.\d+)?)(([+*-]((pi|PI)|\d+(\.\d*)?))|(\/((pi|PI)|[1-9]\d*(\.\d+)?|\d+\.[0-9]*[1-9][0-9]*))|(\^)(\d+|(pi|PI)))*\"$/);var x=r.match(m);$(i).find("rect").attr("operation",x[0].replace(/\"/g,""))}propertyBoard($("rect[focus=true][index='0']").attr("qi")+"-"+$("rect[focus=true][index='0']").attr("qs"),1),dragObj($("rect[focus=true][index='0']").attr("qi")+"-"+$("rect[focus=true][index='0']").attr("qs"))}}function checkCircle(){$("rect[index='0']").each(function(){if(null!=$(this).attr("id")&&0<$(this).attr("id").length){var t=$(this).attr("id");if(0<=t.indexOf("n2")||0<=t.indexOf("n3"))return;$(this).attr("focus","false").attr("r","3").attr("stroke","none").attr("fill","#fff"),$(this).attr("focus","false").attr("r","3").attr("stroke","none").attr("fill-opacity","0")}else $(this).attr("focus","false").attr("r","3").attr("stroke","none").attr("fill","#fff"),$(this).attr("focus","false").attr("r","3").attr("stroke","none").attr("fill-opacity","0")})}function initTemplate(t){$("#modRight_center").html(""),svgBoard(qubitNum,100<t?t:100,classicalbitNum,"$"),yIndex=1,isInit=!(xIndex=0)}function checkMeasureLocation(r,n,t){var a=!1;return $("rect[qi="+r+"][index='0']").each(function(){var t=$(this).attr("qs");if(parseInt(t)<parseInt(n)){var e=r+"-"+t;if(0<$("#"+e).length&&"Measure"==$("#"+e).attr("type"))return!(a=!0)}}),!a||(prompt(messages.measure_not_more_qubit_in_line+t),!1)}function checkRepeat(t,e){var r=!0;for(var n in hash={},t){if(hash[t[n]])return prompt(messages.contain_repeating_coordinates+e),r=!1;hash[t[n]]=!0}return r}var svgDivLeft,svgDivWidth,svgDivRight,svgDivTop,svgDivHeight,svgDivBottom,oldDqI,oldDqS,fixedHeight=50,oQi=-1,oQs=-1,isSelfDrag=!1;function initDragObj(){dragObj("dragH"),dragObj("dragNOT"),dragObj("dragZPi"),dragObj("dragXPi2"),dragObj("dragYPi2"),dragObj("dragZPi2"),dragObj("dragCNOT"),dragObj("dragiSWAP"),dragObj("dragToffoli"),dragObj("dragMeasure"),dragObj("dragRX"),dragObj("dragRY"),dragObj("dragRZ"),dragObj("dragCR"),dragObj("GHZ2"),dragObj("GHZ3"),dragObj("GHZ6"),dragObj("QFT3"),dragObj("QFT4"),dragObj("CZ"),dragObj("z-CNOT"),dragObj("SWAP"),dragObj("H6"),dragObjAll("LayerContent","LayerMove")}function dragObj(t){if(null!=fromAdmin&&"1"==fromAdmin)return!1;var l=document.getElementById(t);if(null==l||null==l)return!1;var e=document.getElementsByClassName("content")[0],r={l:0,r:e.offsetWidth-l.offsetWidth,t:0,b:e.offsetHeight-l.offsetHeight,n:10},n=document.documentElement.clientWidth||document.body.clientWidth,a=document.documentElement.clientHeight||document.body.clientHeight,m=(r=r||{}).l||0,g=r.r||n-l.offsetWidth,x=r.t||0,y=r.b||a-l.offsetHeight;r.n;l.onmousedown=function(t){var d=!1,e=t||event,p="",f=(e.clientX,l.offsetLeft,e.clientY,l.offsetTop,0);return document.onmousemove=function(t){if(!(10<++f))return!1;if(resetHL(),$(".LayerSetting").hide(),$(".pic-blue").removeClass("current"),svgDivTop=$(".modRight_center").offset().top,svgDivHeight=$(".modRight_center").height(),svgDivBottom=parseInt(svgDivTop)+parseInt(svgDivHeight),isDrag=!0,oQi=$(l).attr("qi"),oQs=$(l).attr("qs"),null!=oQi&&null!=oQs&&(isSelfDrag=!0,p=l),parseInt(qubitNum)<parseInt(6)){var e=$("rect[qi="+parseInt(qubitNum-1)+"][qs=1][index='0']").offset().top;svgDivBottom=parseInt(e)+parseInt(fixedHeight)}var r=(c=t||event).clientX,n=c.clientY;if(r<0?r=0:r>document.documentElement.clientWidth-l.offsetWidth&&(r=document.documentElement.clientWidth-l.offsetWidth),n<0?n=0:n>document.clientHeight&&(n=document.clientHeight-l.offsetHeight),currentType=$(l).attr("type"),currentX=r,currentY=n,0<parseInt(scrollTop)&&(svgDivTop=parseInt(svgDivTop)-parseInt(scrollTop),svgDivBottom=parseInt(svgDivBottom)-parseInt(scrollTop)),parseInt(currentX)>parseInt(svgDivLeft)&&parseInt(currentX)<parseInt(svgDivRight)&&parseInt(currentY)>parseInt(svgDivTop)&&parseInt(currentY)<parseInt(svgDivBottom)){var a="";if(null!=$(l).attr("imgName")&&0<$(l).attr("imgName").length)a=$(l).attr("imgName");else{if(null!=$(l).attr("n2")&&0<$(l).attr("n2").length){var i=$(l).attr("n2");$("line[n2="+i+"]").hide(),$("#"+i).hide()}if(null!=$(l).attr("n3")&&0<$(l).attr("n3").length){var s=$(l).attr("n3");$("line[n3="+s+"]").hide(),$("#"+s).hide()}$(l).parent().hide(),a=getImgName(currentType),d=!0}var c,o=(c=t||event).clientX-40,u=c.clientY-20+$(window).scrollTop();o<=m&&(o=m),g<=o&&(o=g),u<=x&&(u=x),y<=u&&(u=y),$("#dragImgBox").css({left:o+"px",top:u+"px"}),$("#dragImgBox img").attr("src",base+"/assets/images/"+a),$("#dragImgBox").show()}else $("body").css({cursor:"not-allowed"})},!(document.onmouseup=function(){if(null==currentX||null==currentY)document.onmousemove=null,document.onmouseup=null;else{$("body").css({cursor:"default"}),document.onmousemove=null,document.onmouseup=null;var a=-1,i=-1,s=-1,c=0;if(parseInt(currentX)>parseInt(svgDivLeft)&&parseInt(currentX)<parseInt(svgDivRight)&&parseInt(currentY)>parseInt(svgDivTop)&&parseInt(currentY)<parseInt(svgDivBottom))if($("svg rect[index='0']").each(function(t,e){var r=$(e).offset().left,n=$(e).offset().top;if(0<parseInt(scrollTop)&&(n=parseInt(n)-parseInt(scrollTop)),parseInt(r)>parseInt(svgDivLeft)&&parseInt(r)<parseInt(svgDivRight)&&parseInt(n)>parseInt(svgDivTop)&&parseInt(n)<parseInt(svgDivBottom))if(parseFloat(r)>parseFloat(currentX)){if(!(parseFloat(r)-parseFloat(currentX)<30))return;if(parseFloat(n)>parseFloat(currentY)){if(!(parseFloat(n)-parseFloat(currentY)<30))return;if(-1==s)c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),s=c,a=$(this).attr("qi"),i=$(this).attr("qs");else{if(c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),parseFloat(s)<parseFloat(c))return;s=c,a=$(this).attr("qi"),i=$(this).attr("qs")}}else{if(!(parseFloat(currentY)-parseFloat(n)<30))return;if(-1==s)c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),s=c,a=$(this).attr("qi"),i=$(this).attr("qs");else{if(c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),parseFloat(s)<parseFloat(c))return;s=c,a=$(this).attr("qi"),i=$(this).attr("qs")}}}else{if(!(parseFloat(currentX)-parseFloat(r)<30))return;if(parseFloat(n)>parseFloat(currentY)){if(!(parseFloat(n)-parseFloat(currentY)<30))return;if(-1==s)c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),s=c,a=$(this).attr("qi"),i=$(this).attr("qs");else{if(c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),parseFloat(s)<parseFloat(c))return;s=c,a=$(this).attr("qi"),i=$(this).attr("qs")}}else{if(!(parseFloat(currentY)-parseFloat(n)<30))return;if(-1==s)c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),s=c,a=$(this).attr("qi"),i=$(this).attr("qs");else{if(c=Math.abs(parseFloat(r)-parseFloat(currentX))+Math.abs(parseFloat(n)>parseFloat(currentY)),parseFloat(s)<parseFloat(c))return;s=c,a=$(this).attr("qi"),i=$(this).attr("qs")}}}}),-1!=a&&-1!=i){if(a==oQi&&i==oQs)return showIcon(l),$("#dragImgBox").hide(),!1;if(checkGrammar(isSelfDrag,p,a,i,d)){checkCircle();var t=multiBitGateJudgment(a,i),e=[],r=$("svg rect[qi="+a+"][qs="+i+"][index='0']");if($('line[x1="'+(parseInt(r.attr("x"))+30)+'"]').each(function(){e.push({y1:$(this).attr("y1"),y2:$(this).attr("y2")})}),""!=e){for(var n=0,o=0;o<e.length;o++)if(parseInt(r.attr("y"))>parseInt(e[o].y1)&&parseInt(r.attr("y"))<parseInt(e[o].y2)){n=1;break}if(1==n)return prompt(messages.point_already_exists),showIcon(l),isDrag=!1,currentY=currentX=0,isSelfDrag=!(i=a=-1)}t?($("svg rect[qi="+a+"][qs="+i+"][index='0']").click(),setTimeout(function(){isDrag=!0;var t=checkCoordinates(currentType);if(clickTrans(currentType),currentY=currentX=0,isSelfDrag=!(i=a=-1),d&&t){var e=$("#projectId").val();if(257==e||258==e||259==e||260==e)return $(l).parent().show(),$("#dragImgBox").hide(),!1;deleteIcon(l)}else showIcon(l);$("#dragImgBox").hide()},200)):showIcon(l)}else d&&showIcon(l),i=a=-1,currentY=currentX=0}else d&&showIcon(l);else d&&showIcon(l);$(".cloneEle").remove()}})}}function dragObjAll(t,e){var r=document.getElementById(e),s=document.getElementById(t),n=document.getElementsByClassName("content")[0],a={l:0,r:n.offsetWidth-s.offsetWidth,t:0,b:n.offsetHeight-s.offsetHeight,n:10},i=document.documentElement.clientWidth||document.body.clientWidth,c=document.documentElement.clientHeight||document.body.clientHeight,o=(a=a||{}).l||0,u=a.r||i-s.offsetWidth,d=a.t||0,p=a.b||c-s.offsetHeight;a.n;r.onmousedown=function(t){r.style.cursor="move";var e=t||event,a=e.clientX-s.offsetLeft,i=e.clientY-s.offsetTop;return document.onmousemove=function(t){var e=t||event,r=e.clientX-a,n=e.clientY-i;r<=o&&(r=o),u<=r&&(r=u),n<=d&&(n=d),p<=n&&(n=p),s.style.left=r+"px",s.style.top=n+"px"},!(document.onmouseup=function(){r.style.cursor="default",document.onmousemove=null,document.onmouseup=null})}}function clickTrans(t){"H"==t?$("#dragH").click():"NOT"==t?$("#dragNOT").click():"ZPi"==t?$("#dragZPi").click():"XPi2"==t?$("#dragXPi2").click():"YPi2"==t?$("#dragYPi2").click():"ZPi2"==t?$("#dragZPi2").click():"CNOT"==t?$("#dragCNOT").click():"iSWAP"==t?$("#dragiSWAP").click():"Toffoli"==t?$("#dragToffoli").click():"Measure"==t?$("#dragMeasure").click():"RZ"==t?$("#dragRZ").click():"RX"==t?$("#dragRX").click():"RY"==t?$("#dragRY").click():"CR"==t?$("#dragCR").click():"GHZ2"==t?$("#GHZ2").click():"GHZ3"==t?$("#GHZ3").click():"GHZ6"==t?$("#GHZ6").click():"QFT3"==t?$("#QFT3").click():"QFT4"==t?$("#QFT4").click():"CZ"==t?$("#CZ").click():"z-CNOT"==t?$("#z-CNOT").click():"SWAP"==t?$("#SWAP").click():"H6"==t&&$("#H6").click()}function getImgName(t){var e="";switch(t){case"H":e="New_H.png";break;case"NOT":e="New_Not.png";break;case"ZPi":e="New_Z.png";break;case"XPi2":e="New_Xpi2.png";break;case"YPi2":e="New_Ypi2.png";break;case"ZPi2":e="New_Zpi2.png";break;case"CNOT":e="New_Cont.png";break;case"iSWAP":e="New_Iswp.png";break;case"Toffoli":e="New_Toff.png";break;case"RX":e="New_Xpi.png";break;case"RY":e="New_Ypi.png";break;case"RZ":e="New_Zpi.png";break;case"CR":e="New_CR.png";break;case"Measure":e="New_Measure.png"}return e}function deleteIcon(t){if($(t).attr("refid")){var e=$(t).attr("refid");"iSWAP"==$(t).attr("type")&&$("#"+$("#"+e).attr("n2")).parent().remove(),$("line[n2='"+$("#"+e).attr("n2")+"']").remove(),$("#"+$("#"+e).attr("n2")).remove(),$("line[n3='"+$("#"+e).attr("n3")+"']").remove(),$("#"+$("#"+e).attr("n3")).remove(),$("rect[refid='"+e+"']").remove(),$("#"+e).parent().remove()}else 0<$("line[n2='"+$(t).attr("n2")+"']").length||0==$("line[n2='"+$(t).attr("n2")+"']").length?($("line[n2='"+$(t).attr("n2")+"']").remove(),"iSWAP"==$(t).attr("type")&&$("#"+$(t).attr("n2")).parent().remove(),$("#"+$(t).attr("n2")).remove(),$("line[n3='"+$(t).attr("n3")+"']").remove(),$("#"+$(t).attr("n3")).remove()):($("line[n2='"+$(t).parent().find("rect").attr("n2")+"']").remove(),"iSWAP"==$(t).parent().find("rect").attr("type")&&$("#"+$(t).parent().find("rect").attr("n2")).parent().remove(),$("#"+$(t).parent().find("rect").attr("n2")).remove(),$("line[n3='"+$(t).parent().find("rect").attr("n3")+"']").remove(),$("#"+$(t).parent().find("rect").attr("n3")).remove()),$(t).parent().remove()}function checkCoordinates(t){var i=$("rect[focus=true][index='0']").attr("qi"),s=$("rect[focus=true][index='0']").attr("qs");if("Measure"==t){var e=-1,r="",n=!1,a=1;if($("rect[qi="+i+"][index='0']").each(function(){var t=$(this).attr("qs");if(r=i+"-"+t,0<$("#"+r).length&&(parseInt(+$("#"+r).attr("qi"))==parseInt(oQi)&&parseInt(+$("#"+r).attr("qs"))==parseInt(oQs)||(e=t),"Measure"==$("#"+r).attr("type"))){if(isDrag){if(parseInt(+$("#"+r).attr("qi"))==parseInt(oQi)&&parseInt(+$("#"+r).attr("qs"))==parseInt(oQs))return;a+=1}else a+=1;if(n)return;n=!0}}),parseInt(s)<=parseInt(e))return!1;if(n&&!isDrag)return!1;if(isDrag&&(n=!1),1<parseInt(a))return!1;var c="";if($("rect[qi="+i+"][index='0']").each(function(){var t=$(this).attr("qs");if(parseInt(t)>parseInt(s)&&(0<$("rect[qi="+i+"][qs="+t+"][index='0']").length||0<$("rect[qi="+i+"][qs="+t+"][index='1']").length))if(0<$("rect[qi="+i+"][qs="+t+"][index='1']").length){var e=$("rect[qi="+i+"][qs="+t+"][index='1']");if(0<=e.attr("id").indexOf("n2")||0<=e.attr("id").indexOf("n3"))return!(n=!0);if(getIdentification(c=buildIdentification(c,i+"-"+t),i+"-"+t))return!(n=!0)}else if(getIdentification(c=buildIdentification(c,i+"-"+t),i+"-"+t))return!(n=!0)}),n)return!1}else{e=-1,r="",n=!1;if($("rect[qi="+i+"][index='0']").each(function(){var t=$(this).attr("qs");r=i+"-"+t,0<$("#"+r).length&&"Measure"==$("#"+r).attr("type")&&(e=t)}),-1!=parseInt(e)&&parseInt(e)<=parseInt(s))return!1}if(0<$("#"+(i+"-"+s)).length)return!1;var o=!0;return $("line[name='verticalLine']").each(function(t,e){var r=$(e).attr("x1"),n=$(e).attr("y1"),a=($(e).attr("x2"),$(e).attr("y2"));if(s*columnHigh==r&&(n/lineHigh<i&&i<a/lineHigh))return o=!1}),!!o}function showIcon(t){if($(t).parent().show(),null!=$(t).attr("n2")&&0<$(t).attr("n2").length){var e=$(t).attr("n2");$("line[n2="+e+"]").show(),$("#"+e).show()}if(null!=$(t).attr("n3")&&0<$(t).attr("n3").length){var r=$(t).attr("n3");$("line[n3="+r+"]").show(),$("#"+r).show()}$("#dragImgBox").hide(),0<$("rect[focus=true][index='0']").length&&("CNOT"!=$(t).attr("type")&&"iSWAP"!=$(t).attr("type")&&"Toffoli"!=$(t).attr("type")&&"CR"!=$(t).attr("type")||null!=$(t).attr("n2")&&null!=$(t).attr("n3")||AttBuit(2)),isDrag=!1}function multiBitGateJudgment(a,t){var i=new Array,s=!0;return $("svg rect[qs="+t+"][index='0']").each(function(){var t=$(this).attr("qi")+"-"+$(this).attr("qs");if(0<$("#"+t).length){var e=$("#"+t).attr("type");if("Toffoli"==e||"CNOT"==e||"iSWAP"==e||"CR"==e){i[i.length]=$(this).attr("qi");var r=$("#"+t).attr("n2");if(i[i.length]=$("#"+r).attr("qi"),null!=$("#"+t).attr("n3")&&0<$("#"+t).attr("n3").length){var n=$("#"+t).attr("n3");i[i.length]=$("#"+n).attr("qi")}}}if(i.sort(),0<i.length&&parseInt(i[0])<parseInt(a)&&parseInt(a)<parseInt(i[i.length-1]))return s=!1}),!!s||(currentY=currentX=void 0,prompt(messages.already_exists_on_vertical_line),!1)}window.onload=function(){if(null!=fromAdmin&&"1"==fromAdmin)return!1;svgDivLeft=$(".modRight_center").offset().left,svgDivWidth=$(".modRight_center").width(),svgDivRight=parseInt(svgDivLeft)+parseInt(svgDivWidth),svgDivTop=$(".NewModule").offset().top,svgDivHeight=$(".NewModule").height(),svgDivBottom=parseInt(svgDivTop)+parseInt(svgDivHeight),initDragObj()},window.onscroll=function(){scrollTop=$(window).scrollTop()},$(window).resize(function(){if(null!=fromAdmin&&"1"==fromAdmin)return!1;initDragObj()});